<%# 사용자 아바타 - 재사용 가능한 컴포넌트 %>
<%# 사용법: render partial: "shared/avatar", locals: { user: @user } %>
<%# 옵션: %>
<%#   size: "sm" | "md" | "lg" | "xl" (기본값: "md") %>
<%#   class_name: 추가 CSS 클래스 %>

<% user = local_assigns[:user] %>
<% size = local_assigns.fetch(:size, "md") %>
<% additional_class = local_assigns.fetch(:class_name, "") %>

<%
  size_classes = {
    "sm" => "h-8 w-8",
    "md" => "h-10 w-10",
    "lg" => "h-12 w-12",
    "xl" => "h-24 w-24"
  }

  text_size_classes = {
    "sm" => "text-sm",
    "md" => "text-lg",
    "lg" => "text-xl",
    "xl" => "text-3xl"
  }

  container_class = size_classes[size] || size_classes["md"]
  text_class = text_size_classes[size] || text_size_classes["md"]
%>

<% if user.nil? %>
  <%# 탈퇴한 회원 - Ghost Icon (Design God's Tip) %>
  <div class="<%= container_class %> rounded-full bg-stone-200 flex items-center justify-center overflow-hidden flex-shrink-0 <%= additional_class %>">
    <%
      icon_size_classes = {
        "sm" => "w-4 h-4",
        "md" => "w-5 h-5",
        "lg" => "w-6 h-6",
        "xl" => "w-12 h-12"
      }
      icon_class = icon_size_classes[size] || icon_size_classes["md"]
    %>
    <svg class="<%= icon_class %> text-stone-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
    </svg>
  </div>
<% elsif user.using_anonymous_avatar? %>
  <%# 익명 모드 - 흰색 배경 + 익명 아바타 이미지 %>
  <div class="<%= container_class %> rounded-full bg-white border border-gray-200 flex items-center justify-center overflow-hidden flex-shrink-0 <%= additional_class %>">
    <%= image_tag "/anonymous#{user.avatar_type.to_i + 1}-.png", alt: user.display_name, class: "h-full w-full object-cover" %>
  </div>
<% else %>
  <%# 실명 모드 또는 프로필 미완료 %>
  <div class="<%= container_class %> rounded-full bg-secondary flex items-center justify-center overflow-hidden flex-shrink-0 <%= additional_class %>">
    <% if user.avatar.attached? %>
      <%= image_tag user.avatar, alt: user.display_name, class: "h-full w-full object-cover" %>
    <% elsif user.avatar_url.present? %>
      <%= image_tag user.avatar_url, alt: user.display_name, class: "h-full w-full object-cover" %>
    <% else %>
      <span class="<%= text_class %> font-semibold text-muted-foreground"><%= user.display_name[0] %></span>
    <% end %>
  </div>
<% end %>
