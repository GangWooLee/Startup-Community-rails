<%#
  플로팅 글쓰기 버튼 - Speed Dial 패턴
  Creator's Canvas Modal 연동

  개선 사항:
  - 기존: FAB → 바텀시트(오버레이) → 옵션 선택 (3단계)
  - 개선: FAB → 미니 FAB 확장 → Canvas Modal (2단계)

  Features:
  - Speed Dial: FAB 클릭 시 미니 FAB 버튼들이 위로 확장
  - Staggered Animation: 순차적으로 나타나는 애니메이션
  - 외부 클릭 시 자동 닫힘
  - ESC 키로 닫기
  - 라벨 호버 시 표시 (PC)
  - Canvas Modal 연동: 버튼 클릭 시 모달 오픈
%>
<% show_write_button = logged_in? && !@hide_floating_button %>
<% if show_write_button %>
  <div data-controller="write-bottomsheet" class="fixed bottom-24 right-4 z-50">
    <%# Backdrop (반투명, 터치 영역) %>
    <div
      data-write-bottomsheet-target="backdrop"
      data-action="click->write-bottomsheet#closeSpeedDial"
      class="fixed inset-0 bg-black/20 -z-10 hidden opacity-0 transition-opacity duration-200"
    ></div>

    <%# Speed Dial Items Container %>
    <div
      data-write-bottomsheet-target="speedDial"
      class="absolute bottom-16 right-0 flex flex-col items-end gap-3 pb-4 pointer-events-none"
    >
      <%# Item 1: Join Project (Outsourcing) - Canvas Modal 트리거 %>
      <button type="button"
              data-speed-dial-item="true"
              onclick="window.dispatchEvent(new CustomEvent('canvas-modal:open', { detail: { type: 'outsourcing' } }))"
              data-action="click->write-bottomsheet#closeSpeedDial"
              class="group flex items-center gap-3 opacity-0 translate-y-4 scale-75
                     transition-all duration-200 ease-out touch-manipulation">
        <%# Label (PC 호버 시 표시) %>
        <span class="hidden sm:block px-3 py-1.5 rounded-lg bg-stone-800 text-white text-sm font-medium
                     opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap shadow-lg">
          Join Project
        </span>
        <%# Mini FAB - Rocket icon %>
        <div class="h-12 w-12 rounded-full bg-emerald-500 text-white shadow-lg shadow-emerald-500/30
                    flex items-center justify-center hover:scale-110 active:scale-95 transition-transform">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M13 10V3L4 14h7v7l9-11h-7z"/>
          </svg>
        </div>
      </button>

      <%# Item 2: Community Post - Canvas Modal 트리거 %>
      <button type="button"
              data-speed-dial-item="true"
              onclick="window.dispatchEvent(new CustomEvent('canvas-modal:open', { detail: { type: 'community' } }))"
              data-action="click->write-bottomsheet#closeSpeedDial"
              class="group flex items-center gap-3 opacity-0 translate-y-4 scale-75
                     transition-all duration-200 ease-out touch-manipulation">
        <%# Label (PC 호버 시 표시) %>
        <span class="hidden sm:block px-3 py-1.5 rounded-lg bg-stone-800 text-white text-sm font-medium
                     opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap shadow-lg">
          커뮤니티 글
        </span>
        <%# Mini FAB %>
        <div class="h-12 w-12 rounded-full bg-blue-500 text-white shadow-lg shadow-blue-500/30
                    flex items-center justify-center hover:scale-110 active:scale-95 transition-transform">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
          </svg>
        </div>
      </button>
    </div>

    <%# Main FAB Button %>
    <button
      type="button"
      data-write-bottomsheet-target="mainButton"
      data-action="click->write-bottomsheet#toggle"
      class="h-14 w-14 sm:h-16 sm:w-16 rounded-full
             bg-gradient-to-br from-orange-500 to-amber-500
             text-white shadow-xl shadow-orange-500/30
             flex items-center justify-center
             hover:scale-110 active:scale-95
             transition-all duration-300
             touch-manipulation"
    >
      <svg class="w-6 h-6 sm:w-7 sm:h-7 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 4v16m8-8H4"/>
      </svg>
    </button>
  </div>
<% end %>
