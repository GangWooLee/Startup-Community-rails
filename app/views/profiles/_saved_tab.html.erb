<%# 저장됨 탭 콘텐츠 Partial (본인 프로필 전용) %>
<%# locals: user %>

<%
  # 데이터 로드
  bookmarked_posts = user.bookmarked_posts
                         .includes(:user, images_attachments: :blob)
                         .recent
                         .limit(10)

  liked_posts = user.liked_posts
                    .includes(:user, images_attachments: :blob)
                    .recent
                    .limit(10)

  commented_posts = user.commented_posts
                        .includes(:user, images_attachments: :blob)
                        .recent
                        .limit(10)
%>

<div class="space-y-4" data-controller="saved-filter">
  <%# 드롭다운 필터 헤더 %>
  <div class="flex items-center justify-between">
    <%# 필터 드롭다운 %>
    <div class="relative">
      <button type="button"
              class="inline-flex items-center gap-2 px-4 py-2 rounded-xl
                     bg-white/80 border border-stone-200/60 text-sm font-medium
                     text-stone-700 hover:bg-stone-50 transition-all shadow-sm"
              data-action="click->saved-filter#toggle">
        <span data-saved-filter-target="label">스크랩</span>
        <svg class="w-4 h-4 text-stone-400 transition-transform duration-200"
             data-saved-filter-target="arrow"
             fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
        </svg>
      </button>

      <%# 드롭다운 메뉴 %>
      <div class="hidden absolute left-0 mt-2 w-40 py-1 bg-white rounded-xl
                  shadow-lg border border-stone-200/60 z-50"
           data-saved-filter-target="menu">
        <button type="button"
                class="w-full px-4 py-2.5 text-left text-sm transition-colors
                       flex items-center gap-2"
                data-action="click->saved-filter#select"
                data-filter="bookmarks"
                data-saved-filter-target="filterButton">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"/>
          </svg>
          스크랩
        </button>
        <button type="button"
                class="w-full px-4 py-2.5 text-left text-sm transition-colors
                       flex items-center gap-2"
                data-action="click->saved-filter#select"
                data-filter="likes"
                data-saved-filter-target="filterButton">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
          </svg>
          좋아요
        </button>
        <button type="button"
                class="w-full px-4 py-2.5 text-left text-sm transition-colors
                       flex items-center gap-2"
                data-action="click->saved-filter#select"
                data-filter="comments"
                data-saved-filter-target="filterButton">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
          </svg>
          댓글
        </button>
      </div>
    </div>

    <%# 안내 문구 %>
    <span class="text-xs text-stone-400 flex items-center gap-1">
      <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
      </svg>
      본인에게만 보입니다
    </span>
  </div>

  <%# ─────────────────────────────────────────────────────────────────────── %>
  <%# 스크랩 콘텐츠 %>
  <%# ─────────────────────────────────────────────────────────────────────── %>
  <div data-saved-filter-target="content" data-filter-type="bookmarks">
    <% if bookmarked_posts.any? %>
      <div class="space-y-3">
        <% bookmarked_posts.each do |post| %>
          <%= render "profiles/saved_post_card", post: post, icon: "bookmark" %>
        <% end %>

        <% if bookmarked_posts.size >= 10 %>
          <p class="text-center text-sm text-stone-400 pt-2">더 많은 글이 있습니다</p>
        <% end %>
      </div>
    <% else %>
      <%= render "profiles/empty_state",
          icon: "bookmark",
          title: "스크랩한 글이 없습니다",
          description: "관심 있는 글을 북마크해보세요",
          action_text: "커뮤니티 둘러보기",
          action_path: community_path %>
    <% end %>
  </div>

  <%# ─────────────────────────────────────────────────────────────────────── %>
  <%# 좋아요 콘텐츠 %>
  <%# ─────────────────────────────────────────────────────────────────────── %>
  <div class="hidden" data-saved-filter-target="content" data-filter-type="likes">
    <% if liked_posts.any? %>
      <div class="space-y-3">
        <% liked_posts.each do |post| %>
          <%= render "profiles/saved_post_card", post: post, icon: "heart" %>
        <% end %>

        <% if liked_posts.size >= 10 %>
          <p class="text-center text-sm text-stone-400 pt-2">더 많은 글이 있습니다</p>
        <% end %>
      </div>
    <% else %>
      <%= render "profiles/empty_state",
          icon: "heart",
          title: "좋아요한 글이 없습니다",
          description: "마음에 드는 글에 좋아요를 눌러보세요",
          action_text: "커뮤니티 둘러보기",
          action_path: community_path %>
    <% end %>
  </div>

  <%# ─────────────────────────────────────────────────────────────────────── %>
  <%# 댓글 콘텐츠 %>
  <%# ─────────────────────────────────────────────────────────────────────── %>
  <div class="hidden" data-saved-filter-target="content" data-filter-type="comments">
    <% if commented_posts.any? %>
      <div class="space-y-3">
        <% commented_posts.each do |post| %>
          <%= render "profiles/saved_post_card", post: post, icon: "comment" %>
        <% end %>

        <% if commented_posts.size >= 10 %>
          <p class="text-center text-sm text-stone-400 pt-2">더 많은 글이 있습니다</p>
        <% end %>
      </div>
    <% else %>
      <%= render "profiles/empty_state",
          icon: "chat",
          title: "댓글 단 글이 없습니다",
          description: "게시글에 의견을 남겨보세요",
          action_text: "커뮤니티 둘러보기",
          action_path: community_path %>
    <% end %>
  </div>
</div>
