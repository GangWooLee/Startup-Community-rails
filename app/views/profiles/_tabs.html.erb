<%# 탭 네비게이션 + 탭 콘텐츠 - Modern Archive Style %>
<%# locals: user, posts, outsourcing_posts, is_own_profile %>

<div data-controller="tabs" data-tabs-default-value="about">

  <%# 탭 헤더 - Sticky + 명확한 인디케이터 (z-40: 활동 카드 backdrop-blur 위에 표시) %>
  <div class="sticky top-[60px] z-40 bg-[#FDFBF7]/95 backdrop-blur-sm -mx-4 px-4 border-b border-stone-200">
    <nav class="flex gap-1 overflow-x-auto scrollbar-hide" data-tabs-target="list" role="tablist">

      <%# 소개 탭 %>
      <button type="button"
              class="flex-shrink-0 px-5 py-3.5 text-sm font-medium border-b-2 transition-all duration-200 is-active
                     [&.is-active]:border-[#2C2825] [&.is-active]:text-[#2C2825]
                     border-transparent text-stone-400 hover:text-stone-600"
              data-tabs-target="trigger"
              data-action="click->tabs#select keydown->tabs#keydown"
              data-tab-id="about"
              role="tab"
              aria-selected="true">
        <span class="flex items-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
          </svg>
          소개
        </span>
      </button>

      <%# 게시글 탭 %>
      <button type="button"
              class="flex-shrink-0 px-5 py-3.5 text-sm font-medium border-b-2 transition-all duration-200
                     [&.is-active]:border-[#2C2825] [&.is-active]:text-[#2C2825]
                     border-transparent text-stone-400 hover:text-stone-600"
              data-tabs-target="trigger"
              data-action="click->tabs#select keydown->tabs#keydown"
              data-tab-id="posts"
              role="tab"
              aria-selected="false">
        <span class="flex items-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
          </svg>
          게시글
          <% if posts.any? %>
            <span class="px-2 py-0.5 text-xs font-medium bg-stone-100 text-stone-600 rounded-full">
              <%= posts.size %>
            </span>
          <% end %>
        </span>
      </button>

      <%# 활동 탭 %>
      <button type="button"
              class="flex-shrink-0 px-5 py-3.5 text-sm font-medium border-b-2 transition-all duration-200
                     [&.is-active]:border-[#2C2825] [&.is-active]:text-[#2C2825]
                     border-transparent text-stone-400 hover:text-stone-600"
              data-tabs-target="trigger"
              data-action="click->tabs#select keydown->tabs#keydown"
              data-tab-id="activity"
              role="tab"
              aria-selected="false">
        <span class="flex items-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M13 10V3L4 14h7v7l9-11h-7z"/>
          </svg>
          활동
        </span>
      </button>

      <%# Project 탭 %>
      <button type="button"
              class="flex-shrink-0 px-5 py-3.5 text-sm font-medium border-b-2 transition-all duration-200
                     [&.is-active]:border-[#2C2825] [&.is-active]:text-[#2C2825]
                     border-transparent text-stone-400 hover:text-stone-600"
              data-tabs-target="trigger"
              data-action="click->tabs#select keydown->tabs#keydown"
              data-tab-id="market"
              role="tab"
              aria-selected="false">
        <span class="flex items-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
          </svg>
          Project
          <% if outsourcing_posts.any? %>
            <span class="px-2 py-0.5 text-xs font-medium bg-amber-100 text-amber-700 rounded-full">
              <%= outsourcing_posts.size %>
            </span>
          <% end %>
        </span>
      </button>

      <%# 저장됨 탭 (본인만) %>
      <% if is_own_profile %>
        <button type="button"
                class="flex-shrink-0 px-5 py-3.5 text-sm font-medium border-b-2 transition-all duration-200
                       [&.is-active]:border-[#2C2825] [&.is-active]:text-[#2C2825]
                       border-transparent text-stone-400 hover:text-stone-600"
                data-tabs-target="trigger"
                data-action="click->tabs#select keydown->tabs#keydown"
                data-tab-id="saved"
                role="tab"
                aria-selected="false">
          <span class="flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"/>
            </svg>
            저장됨
          </span>
        </button>
      <% end %>
    </nav>
  </div>

  <%# 탭 콘텐츠 - 상단 여백 추가 %>
  <div class="pt-6">
    <div data-tabs-target="panel" data-tab-id="about" role="tabpanel">
      <%= render "profiles/about_tab", user: user %>
    </div>

    <div data-tabs-target="panel" data-tab-id="posts" class="hidden" role="tabpanel">
      <%= render "profiles/posts_tab", user: user, posts: posts %>
    </div>

    <div data-tabs-target="panel" data-tab-id="activity" class="hidden" role="tabpanel">
      <%= render "profiles/activity_tab", user: user %>
    </div>

    <div data-tabs-target="panel" data-tab-id="market" class="hidden" role="tabpanel">
      <%= render "profiles/market_tab", user: user, posts: outsourcing_posts %>
    </div>

    <% if is_own_profile %>
      <div data-tabs-target="panel" data-tab-id="saved" class="hidden" role="tabpanel">
        <%= render "profiles/saved_tab", user: user %>
      </div>
    <% end %>
  </div>
</div>
