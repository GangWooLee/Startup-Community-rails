<%# Experience Timeline Partial %>
<%# locals: user, viewer %>

<% if user.has_experiences? %>
  <%= privacy_blur_wrapper(visible: user.experience_visible_to?(local_assigns[:viewer])) do %>
  <section class="p-6 rounded-xl bg-white/80 backdrop-blur-xl
                  border border-white/50 shadow-[0_4px_20px_rgb(0,0,0,0.03)]">
    <h3 class="flex items-center gap-2 text-sm font-bold text-[#2C2825] mb-4">
      <span class="flex items-center justify-center w-7 h-7 rounded-lg bg-indigo-100">
        <svg class="w-4 h-4 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
      </span>
      경력 & 경험
    </h3>

    <%# Timeline 컨테이너 %>
    <div class="relative">
      <%# 세로 연결선 %>
      <div class="absolute left-4 top-0 bottom-0 w-0.5 bg-gradient-to-b from-indigo-200 via-stone-200 to-transparent"></div>

      <div class="space-y-4">
        <% user.sorted_experiences.each_with_index do |exp, index| %>
          <% exp_type = User::EXPERIENCE_TYPES[exp["type"]] || User::EXPERIENCE_TYPES["work"] %>

          <div class="relative pl-10 group">
            <%# 타임라인 노드 (아이콘) %>
            <div class="absolute left-0 w-8 h-8 rounded-xl flex items-center justify-center
                        <%= exp["is_current"] ? 'bg-indigo-100 ring-2 ring-indigo-300 ring-offset-2' : 'bg-stone-100' %>
                        transition-all group-hover:scale-110">
              <% case exp["type"] %>
              <% when "work" %>
                <svg class="w-4 h-4 <%= exp["is_current"] ? 'text-indigo-600' : 'text-stone-500' %>"
                     fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                </svg>
              <% when "education" %>
                <svg class="w-4 h-4 <%= exp["is_current"] ? 'text-indigo-600' : 'text-stone-500' %>"
                     fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 14l9-5-9-5-9 5 9 5z"/>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z"/>
                </svg>
              <% when "project" %>
                <svg class="w-4 h-4 <%= exp["is_current"] ? 'text-indigo-600' : 'text-stone-500' %>"
                     fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                </svg>
              <% when "award" %>
                <svg class="w-4 h-4 <%= exp["is_current"] ? 'text-indigo-600' : 'text-stone-500' %>"
                     fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
                </svg>
              <% when "certification" %>
                <svg class="w-4 h-4 <%= exp["is_current"] ? 'text-indigo-600' : 'text-stone-500' %>"
                     fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"/>
                </svg>
              <% else %>
                <svg class="w-4 h-4 <%= exp["is_current"] ? 'text-indigo-600' : 'text-stone-500' %>"
                     fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                </svg>
              <% end %>
            </div>

            <%# 콘텐츠 카드 %>
            <div class="p-4 rounded-xl bg-stone-50/50 hover:bg-stone-50 transition-colors">
              <%# 헤더: 타입 뱃지 + 현재 진행 %>
              <div class="flex items-center gap-2 mb-2">
                <span class="px-2 py-0.5 text-[10px] font-bold rounded-full <%= exp_type[:color] %>">
                  <%= exp_type[:label] %>
                </span>
                <% if exp["is_current"] %>
                  <span class="px-2 py-0.5 text-[10px] font-bold rounded-full bg-green-100 text-green-700">
                    현재
                  </span>
                <% end %>
              </div>

              <%# 제목 + 조직 %>
              <h4 class="font-bold text-[#2C2825] text-sm"><%= exp["title"] %></h4>
              <% if exp["organization"].present? %>
                <p class="text-xs text-stone-500 mt-0.5"><%= exp["organization"] %></p>
              <% end %>

              <%# 기간 %>
              <% if exp["period"].present? %>
                <p class="text-xs text-stone-400 mt-1.5 flex items-center gap-1">
                  <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                  </svg>
                  <%= exp["period"] %>
                </p>
              <% end %>

              <%# 설명 %>
              <% if exp["description"].present? %>
                <p class="text-sm text-stone-600 mt-2 leading-relaxed"><%= exp["description"] %></p>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </section>
  <% end %>
<% end %>
