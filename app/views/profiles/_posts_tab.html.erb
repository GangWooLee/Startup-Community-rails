<%# 게시글 탭 콘텐츠 Partial %>
<%# locals: user, posts, viewer %>

<%= privacy_blur_wrapper(visible: user.posts_visible_to?(local_assigns[:viewer])) do %>
<div class="space-y-4">
  <% if posts.any? %>
    <% posts.each do |post| %>
      <%= link_to post_path(post),
          class: "block p-4 rounded-lg bg-white/60 border border-stone-200/60
                  backdrop-blur-sm transition-all duration-200
                  hover:shadow-md hover:border-orange-200/60 hover:-translate-y-0.5 group" do %>

        <div class="flex gap-4">
          <%# 썸네일 이미지 (있을 경우) %>
          <% if post.images.attached? %>
            <div class="w-20 h-20 flex-shrink-0 rounded-lg overflow-hidden bg-stone-100">
              <%= image_tag post.images.first.variant(:thumb),
                  alt: post.title,
                  class: "w-full h-full object-cover" %>
            </div>
          <% end %>

          <%# 콘텐츠 %>
          <div class="flex-1 min-w-0">
            <%# 카테고리 + 날짜 %>
            <div class="flex items-center gap-2 mb-1">
              <span class="px-2 py-0.5 text-xs font-medium rounded-full
                           <%= case post.category
                               when 'free' then 'bg-stone-100 text-stone-600'
                               when 'question' then 'bg-blue-100 text-blue-600'
                               when 'promotion' then 'bg-purple-100 text-purple-600'
                               else 'bg-stone-100 text-stone-600'
                               end %>">
                <%= Post.human_attribute_name("category.#{post.category}") %>
              </span>
              <span class="text-xs text-stone-400">
                <%= time_ago_in_words(post.created_at) %> 전
              </span>
            </div>

            <%# 제목 %>
            <h4 class="font-medium text-stone-800 group-hover:text-orange-600
                       transition-colors line-clamp-1 mb-1">
              <%= post.title %>
            </h4>

            <%# 본문 미리보기 %>
            <p class="text-sm text-stone-500 line-clamp-2">
              <%= strip_tags(post.content).truncate(100) %>
            </p>

            <%# 통계 %>
            <div class="flex items-center gap-4 mt-2 text-xs text-stone-400">
              <span class="flex items-center gap-1">
                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                </svg>
                <%= post.likes_count %>
              </span>
              <span class="flex items-center gap-1">
                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                </svg>
                <%= post.comments_count %>
              </span>
              <span class="flex items-center gap-1">
                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                </svg>
                <%= post.views_count %>
              </span>
            </div>
          </div>

          <%# 화살표 %>
          <div class="flex items-center">
            <svg class="w-5 h-5 text-stone-300 group-hover:text-orange-400 transition-colors"
                 fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
          </div>
        </div>
      <% end %>
    <% end %>

    <%# 더 보기 링크 %>
    <% if posts.size >= 5 %>
      <div class="text-center pt-4">
        <%= link_to community_path(author: user.id),
            class: "inline-flex items-center gap-2 px-4 py-2 text-sm font-medium
                    text-orange-600 hover:text-orange-700 transition-colors" do %>
          모든 게시글 보기
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
          </svg>
        <% end %>
      </div>
    <% end %>

  <% else %>
    <%= render "profiles/empty_state",
        icon: "document",
        title: "아직 작성한 글이 없습니다",
        description: "커뮤니티에서 첫 글을 작성해보세요" %>
  <% end %>
</div>
<% end %>
