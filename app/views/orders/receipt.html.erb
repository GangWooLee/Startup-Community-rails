<%# 영수증 페이지 %>
<div class="min-h-screen bg-gray-50 py-8">
  <div class="max-w-lg mx-auto px-4">
    <%# 뒤로가기 %>
    <div class="mb-6">
      <%= link_to order_path(@order), class: "inline-flex items-center text-gray-600 hover:text-gray-900" do %>
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
        주문 상세로
      <% end %>
    </div>

    <%# 영수증 카드 %>
    <div class="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden">
      <%# 헤더 %>
      <div class="bg-gradient-to-r from-blue-600 to-blue-700 px-6 py-8 text-center text-white">
        <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-4">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
          </svg>
        </div>
        <h1 class="text-xl font-bold mb-1">결제 영수증</h1>
        <p class="text-blue-100 text-sm">Payment Receipt</p>
      </div>

      <%# 영수증 내용 %>
      <div class="p-6">
        <%# 주문 정보 %>
        <div class="border-b border-dashed border-gray-200 pb-6 mb-6">
          <h2 class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-4">주문 정보</h2>
          <dl class="space-y-3 text-sm">
            <div class="flex justify-between">
              <dt class="text-gray-500">주문번호</dt>
              <dd class="font-mono text-gray-900"><%= @order.order_number %></dd>
            </div>
            <div class="flex justify-between">
              <dt class="text-gray-500">결제일시</dt>
              <dd class="text-gray-900"><%= @payment.approved_at&.strftime("%Y년 %m월 %d일 %H:%M") %></dd>
            </div>
            <div>
              <dt class="text-gray-500 mb-1">상품명</dt>
              <dd class="text-gray-900 font-medium"><%= @order.title %></dd>
            </div>
          </dl>
        </div>

        <%# 결제 금액 %>
        <div class="border-b border-dashed border-gray-200 pb-6 mb-6">
          <h2 class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-4">결제 금액</h2>
          <dl class="space-y-3 text-sm">
            <div class="flex justify-between">
              <dt class="text-gray-500">상품가</dt>
              <dd class="text-gray-900"><%= @order.formatted_amount %></dd>
            </div>
            <% # 할인, 수수료 등이 있다면 여기에 추가 %>
            <div class="flex justify-between pt-3 border-t border-gray-100">
              <dt class="font-semibold text-gray-900">총 결제금액</dt>
              <dd class="font-bold text-lg text-blue-600"><%= @payment.formatted_amount %></dd>
            </div>
          </dl>
        </div>

        <%# 결제 수단 %>
        <div class="border-b border-dashed border-gray-200 pb-6 mb-6">
          <h2 class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-4">결제 수단</h2>
          <dl class="space-y-3 text-sm">
            <div class="flex justify-between">
              <dt class="text-gray-500">결제방법</dt>
              <dd class="text-gray-900"><%= @payment.method_label %></dd>
            </div>
            <% if @payment.method == "CARD" %>
              <% if @payment.card_company.present? %>
                <div class="flex justify-between">
                  <dt class="text-gray-500">카드사</dt>
                  <dd class="text-gray-900"><%= @payment.card_company %></dd>
                </div>
              <% end %>
              <% if @payment.card_number.present? %>
                <div class="flex justify-between">
                  <dt class="text-gray-500">카드번호</dt>
                  <dd class="font-mono text-gray-900"><%= @payment.card_number %></dd>
                </div>
              <% end %>
            <% elsif @payment.virtual_account? %>
              <div class="flex justify-between">
                <dt class="text-gray-500">입금은행</dt>
                <dd class="text-gray-900"><%= @payment.bank_name %></dd>
              </div>
            <% end %>
          </dl>
        </div>

        <%# 판매자/구매자 정보 %>
        <div class="pb-6 mb-6">
          <h2 class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-4">거래 정보</h2>
          <dl class="space-y-3 text-sm">
            <div class="flex justify-between items-center">
              <dt class="text-gray-500">판매자</dt>
              <dd class="flex items-center space-x-2">
                <%= render_user_avatar(@order.seller, size: :xs) %>
                <span class="text-gray-900"><%= @order.seller.name %></span>
              </dd>
            </div>
            <div class="flex justify-between items-center">
              <dt class="text-gray-500">구매자</dt>
              <dd class="flex items-center space-x-2">
                <%= render_user_avatar(@order.user, size: :xs) %>
                <span class="text-gray-900"><%= @order.user.name %></span>
              </dd>
            </div>
          </dl>
        </div>

        <%# 결제 상태 뱃지 %>
        <div class="flex items-center justify-center py-4 bg-green-50 rounded-xl mb-6">
          <svg class="w-5 h-5 text-green-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
          </svg>
          <span class="font-semibold text-green-700">결제 완료</span>
        </div>

        <%# 버튼들 %>
        <div class="space-y-3">
          <% if @payment.receipt_available? %>
            <%= link_to @payment.receipt_url,
                        target: "_blank",
                        rel: "noopener",
                        class: "flex items-center justify-center space-x-2 w-full py-3 px-6 bg-blue-600 text-white font-semibold rounded-xl hover:bg-blue-700 transition-colors" do %>
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
              </svg>
              <span>토스페이먼츠 영수증 보기</span>
            <% end %>
          <% end %>

          <button type="button"
                  onclick="window.print()"
                  class="flex items-center justify-center space-x-2 w-full py-3 px-6 bg-gray-100 text-gray-700 font-semibold rounded-xl hover:bg-gray-200 transition-colors">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"/>
            </svg>
            <span>영수증 인쇄</span>
          </button>
        </div>
      </div>

      <%# 푸터 %>
      <div class="px-6 py-4 bg-gray-50 border-t border-gray-100">
        <p class="text-xs text-gray-500 text-center">
          이 영수증은 결제 확인용으로 발행되었습니다.<br>
          문의사항은 고객센터로 연락해주세요.
        </p>
      </div>
    </div>

    <%# 결제 ID (개발용) %>
    <% if Rails.env.development? %>
      <div class="mt-6 p-4 bg-gray-100 rounded-xl text-xs text-gray-500">
        <p class="font-mono">Payment Key: <%= @payment.payment_key %></p>
        <p class="font-mono">Toss Order ID: <%= @payment.toss_order_id %></p>
      </div>
    <% end %>
  </div>
</div>

<%# 인쇄 스타일 %>
<style media="print">
  @page {
    margin: 1cm;
  }
  body {
    background: white !important;
  }
  .no-print {
    display: none !important;
  }
  button {
    display: none !important;
  }
</style>
