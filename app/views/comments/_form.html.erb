<% post = local_assigns[:post] %>
<% parent_id = local_assigns[:parent_id] %>

<div id="<%= parent_id ? "reply-form-#{parent_id}" : "comment-form" %>"
     class="<%= 'hidden' if parent_id %>"
     data-controller="comment-form"
     data-comment-form-url-value="<%= post_comments_path(post) %>"
     data-parent-id="<%= parent_id %>">
  <div class="flex gap-3">
    <% if defined?(current_user) && current_user %>
      <%= render partial: "shared/avatar", locals: { user: current_user, size: "sm" } %>
    <% end %>
    <div class="flex-1">
      <textarea
        data-comment-form-target="input"
        data-action="input->comment-form#input keydown->comment-form#submitOnEnter"
        rows="2"
        maxlength="1000"
        placeholder="<%= parent_id ? '답글을 입력하세요... (Enter로 전송)' : '댓글을 입력하세요... (Enter로 전송)' %>"
        class="w-full px-3 py-2 text-sm rounded-lg border border-stone-300 bg-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring resize-none"
      ></textarea>
      <div class="flex items-center justify-between mt-2">
        <span data-comment-form-target="counter" class="text-xs text-muted-foreground">0/1000</span>
        <div class="flex gap-2">
          <% if parent_id %>
            <button type="button"
                    data-action="click->reply-toggle#hide"
                    class="px-3 py-1.5 text-xs font-medium text-muted-foreground link-hover relative">
              취소
            </button>
          <% end %>
          <button type="button"
                  data-comment-form-target="submit"
                  data-action="click->comment-form#submit"
                  disabled
                  class="px-4 py-1.5 text-xs font-medium text-primary-foreground bg-primary rounded-md btn-hover disabled:opacity-50 disabled:cursor-not-allowed">
            작성
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
