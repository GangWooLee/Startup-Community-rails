<%# 거래 제안 모달 %>
<%# locals: chat_room %>
<div data-offer-modal-target="modal" class="hidden">
  <!-- 오버레이 -->
  <div class="fixed inset-0 bg-black/50 z-50" data-action="click->offer-modal#close"></div>

  <!-- 모달 컨텐츠 -->
  <div class="fixed inset-0 z-50 flex items-center justify-center p-4 pointer-events-none">
    <div class="bg-white rounded-2xl max-w-md w-full max-h-[90vh] overflow-y-auto pointer-events-auto shadow-xl">
      <!-- 헤더 -->
      <div class="flex items-center justify-between p-4 border-b border-gray-100">
        <div class="flex items-center gap-2">
          <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center">
            <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
          </div>
          <h2 class="text-lg font-bold text-gray-900">거래 제안 보내기</h2>
        </div>
        <button type="button"
                class="p-2 text-gray-400 rounded-full btn-hover"
                data-action="click->offer-modal#close">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>

      <!-- 폼 -->
      <%= form_with url: send_offer_chat_room_messages_path(chat_room),
                    method: :post,
                    class: "p-4 space-y-4",
                    data: { turbo_stream: true, action: "turbo:submit-end->offer-modal#handleSubmit" } do |f| %>

        <!-- 금액 입력 -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">금액 <span class="text-red-500">*</span></label>
          <div class="relative">
            <input type="text"
                   name="offer[amount]"
                   inputmode="numeric"
                   class="w-full border border-gray-300 rounded-xl px-4 py-3 pr-12 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"
                   placeholder="1,000,000"
                   required
                   data-offer-modal-target="amountInput"
                   data-action="input->offer-modal#formatAmount input->offer-modal#calculateNet">
            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 text-sm">원</span>
          </div>
          <p class="text-xs text-gray-500 mt-1.5 flex items-center gap-1">
            <svg class="w-3.5 h-3.5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            수수료 10% 제외 정산 예정:
            <span data-offer-modal-target="netAmount" class="font-medium text-gray-700">0</span>원
          </p>
        </div>

        <!-- 작업 내용 -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">작업 내용 <span class="text-red-500">*</span></label>
          <input type="text"
                 name="offer[title]"
                 class="w-full border border-gray-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"
                 placeholder="MVP 백엔드 API 개발"
                 maxlength="100"
                 required>
        </div>

        <!-- 상세 설명 (선택) -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">상세 설명 <span class="text-gray-400 text-xs font-normal">(선택)</span></label>
          <textarea name="offer[description]"
                    rows="3"
                    class="w-full border border-gray-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none resize-none"
                    placeholder="작업 범위, 산출물, 기타 조건 등"></textarea>
        </div>

        <!-- 작업 기한 -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">작업 기한 <span class="text-red-500">*</span></label>
          <input type="date"
                 name="offer[deadline]"
                 class="w-full border border-gray-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"
                 min="<%= Date.tomorrow.strftime('%Y-%m-%d') %>"
                 required>
        </div>

        <!-- 환불 정책 동의 -->
        <div class="bg-amber-50 border border-amber-200 rounded-xl p-3">
          <label class="flex items-start gap-2 cursor-pointer">
            <input type="checkbox"
                   name="offer[refund_policy]"
                   value="no_refund"
                   class="mt-1 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                   required>
            <span class="text-sm text-amber-800">
              <span class="font-medium">중도 환불 불가에 동의합니다</span><br>
              <span class="text-xs text-amber-700">거래 확정 전 취소 시에만 환불이 가능합니다</span>
            </span>
          </label>
        </div>

        <!-- 안전거래 안내 -->
        <div class="bg-blue-50 border border-blue-200 rounded-xl p-3">
          <div class="flex items-start gap-2">
            <svg class="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
            </svg>
            <div class="text-xs text-blue-800">
              <p class="font-medium mb-1">안전거래 시스템</p>
              <ul class="space-y-0.5 text-blue-700">
                <li>결제 금액은 플랫폼이 안전하게 보관합니다</li>
                <li>작업 완료 후 구매자 확정 시 판매자에게 정산됩니다</li>
              </ul>
            </div>
          </div>
        </div>

        <!-- 제출 버튼 -->
        <button type="submit"
                class="w-full bg-blue-600 text-white py-3.5 rounded-xl font-semibold btn-hover disabled:opacity-50 disabled:cursor-not-allowed"
                data-offer-modal-target="submitButton">
          제안 보내기
        </button>
      <% end %>
    </div>
  </div>
</div>
