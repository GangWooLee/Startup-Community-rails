<div class="min-h-screen bg-background flex flex-col">
  <!-- Header -->
  <header class="sticky top-0 bg-background/95 backdrop-blur-sm border-b border-border z-40">
    <div class="max-w-screen-xl mx-auto px-4 py-4 flex items-center justify-between">
      <div class="flex items-center gap-2">
        <%= render_button variant: :ghost, class: "h-9 w-9 p-0", data: { controller: "navigation", action: "click->navigation#goBack" } do %>
          <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
          </svg>
        <% end %>
        <%# Project Logo - Task #16 %>
        <div class="w-8 h-8 rounded-lg overflow-hidden flex items-center justify-center">
          <img src="/undrew_icon_only.png" alt="Undrew" class="w-8 h-8 object-contain">
        </div>
        <h1 class="text-lg font-semibold text-foreground">Undrew AI</h1>
      </div>
      <!-- 남은 횟수 표시 -->
      <div class="flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-secondary/50 border border-border">
        <svg class="h-4 w-4 text-yellow-500" fill="currentColor" viewBox="0 0 24 24">
          <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
        </svg>
        <span class="text-xs font-medium text-muted-foreground">
          <%= @remaining_analyses %>/<%= @effective_limit %>회 남음
          <% if @has_bonus %>
            <span class="text-yellow-600">(+보너스)</span>
          <% end %>
        </span>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="flex-1 max-w-screen-xl mx-auto w-full px-4 py-6"
        data-controller="ai-input"
        data-ai-input-questions-url-value="<%= onboarding_ai_questions_path %>"
        data-ai-input-analyze-url-value="<%= onboarding_ai_analyze_path %>"
        data-ai-input-csrf-token-value="<%= form_authenticity_token %>">

    <!-- Progress Indicator -->
    <div class="flex items-center justify-center gap-2 mb-8">
      <div class="h-2 w-8 rounded-full bg-primary" data-ai-input-target="progress1"></div>
      <div class="h-2 w-8 rounded-full bg-secondary" data-ai-input-target="progress2"></div>
      <div class="h-2 w-8 rounded-full bg-secondary" data-ai-input-target="progress3"></div>
    </div>

    <!-- Chat Container -->
    <div class="space-y-4 mb-6" data-ai-input-target="chatContainer">
      <!-- AI Initial Message -->
      <div class="flex gap-3" data-ai-input-target="aiMessage">
        <div class="flex-shrink-0 h-10 w-10 rounded-full bg-gradient-to-br from-primary/20 to-primary/5 flex items-center justify-center">
          <svg class="h-5 w-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
          </svg>
        </div>
        <div class="flex-1">
          <p class="text-sm font-medium text-foreground mb-1">AI 분석봇</p>
          <div class="bg-secondary/50 rounded-2xl rounded-tl-md px-4 py-3">
            <p class="text-sm text-foreground">어떤 아이디어가 있으신가요? 자유롭게 적어주세요!</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Step 1: Initial Idea Input -->
    <div data-ai-input-target="step1">
      <div class="bg-card rounded-xl border border-border p-4 mb-4">
        <textarea
          name="idea"
          id="idea-input"
          rows="4"
          placeholder="예: 대학생을 위한 AI 공부 커뮤니티를 만들고 싶어요. 서로 질문하고 답변하면서 학습할 수 있는 플랫폼이요."
          class="w-full bg-transparent text-foreground placeholder:text-muted-foreground resize-none focus:outline-none text-base leading-relaxed"
          data-ai-input-target="textarea"
          data-action="input->ai-input#updateCharCount"
        ></textarea>
        <div class="flex items-center justify-between mt-3 pt-3 border-t border-border">
          <span class="text-xs text-muted-foreground">
            <span data-ai-input-target="charCount">0</span> / 500자
          </span>
        </div>
      </div>

      <!-- Example Ideas -->
      <div class="mb-4">
        <p class="text-xs text-muted-foreground mb-3">예시 아이디어</p>
        <div class="flex flex-wrap gap-2">
          <button type="button" data-action="click->ai-input#fillExample" data-example="대학생들이 서로 스터디 그룹을 만들고 관리할 수 있는 앱" class="px-3 py-1.5 rounded-full bg-secondary/50 text-xs text-muted-foreground btn-hover">
            스터디 매칭 앱
          </button>
          <button type="button" data-action="click->ai-input#fillExample" data-example="프리랜서 개발자와 디자이너를 연결해주는 외주 플랫폼" class="px-3 py-1.5 rounded-full bg-secondary/50 text-xs text-muted-foreground btn-hover">
            외주 매칭 플랫폼
          </button>
          <button type="button" data-action="click->ai-input#fillExample" data-example="AI가 사용자의 일정을 분석하고 최적의 할 일 순서를 추천해주는 투두 앱" class="px-3 py-1.5 rounded-full bg-secondary/50 text-xs text-muted-foreground btn-hover">
            AI 일정 관리
          </button>
        </div>
      </div>

      <!-- Submit Button (Step 1) -->
      <button type="button"
              class="w-full h-14 gap-2 shadow-lg inline-flex items-center justify-center rounded-lg bg-primary text-primary-foreground btn-hover font-medium disabled:opacity-50 disabled:pointer-events-none"
              data-ai-input-target="submitButton"
              data-action="click->ai-input#submitIdea"
              disabled>
        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
        </svg>
        다음
      </button>
    </div>

    <!-- Step 2: Follow-up Questions (Hidden initially) -->
    <div class="hidden" data-ai-input-target="step2">
      <!-- Questions will be dynamically inserted here -->
      <div data-ai-input-target="questionsContainer"></div>

      <!-- Submit Button (Step 2) -->
      <button type="button"
              class="w-full h-14 gap-2 shadow-lg inline-flex items-center justify-center rounded-lg bg-primary text-primary-foreground btn-hover font-medium disabled:opacity-50 disabled:pointer-events-none"
              data-ai-input-target="analyzeButton"
              data-action="click->ai-input#submitForAnalysis"
              disabled>
        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
        </svg>
        AI에게 분석 요청하기
      </button>
    </div>

    <!-- Loading State (Hidden initially) -->
    <div class="hidden text-center py-8" data-ai-input-target="loading">
      <div class="inline-flex items-center gap-3 px-4 py-2 rounded-full bg-secondary/50">
        <div class="animate-spin h-5 w-5 border-2 border-primary border-t-transparent rounded-full"></div>
        <span class="text-sm text-muted-foreground" data-ai-input-target="loadingText">추가 질문 생성 중...</span>
      </div>
    </div>
  </main>
</div>
