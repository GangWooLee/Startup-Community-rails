<%# Ï∂îÏ≤ú Ï†ÑÎ¨∏Í∞Ä Ïπ¥Îìú v2 - Undrew Design System Style %>
<%# locals: prediction, card_index %>

<%
  # prediction Íµ¨Ï°∞: { user:, score_boost:, boost_area:, why: }
  user = prediction[:user]
  score_boost = prediction[:score_boost] || 10
  boost_area = prediction[:boost_area] || "Ï†ÑÎ¨∏ÏÑ±"
  why = prediction[:why] || "#{boost_area} Î≥¥ÏôÑÏóê Ï†ÅÌï©"
  card_index ||= 0

  # Ïó≠Ìï†Î≥Ñ Ïù¥Î™®ÏßÄ Îß§Ìïë
  role_emojis = {
    "developer" => "üíª", "Í∞úÎ∞úÏûê" => "üíª", "ÏóîÏßÄÎãàÏñ¥" => "üíª", "engineer" => "üíª",
    "designer" => "üé®", "ÎîîÏûêÏù¥ÎÑà" => "üé®",
    "marketer" => "üìä", "ÎßàÏºÄÌÑ∞" => "üìä", "ÎßàÏºÄÌåÖ" => "üìä",
    "pm" => "üìã", "Í∏∞ÌöçÏûê" => "üìã", "product manager" => "üìã",
    "ceo" => "üöÄ", "ÎåÄÌëú" => "üöÄ", "Ï∞ΩÏóÖÏûê" => "üöÄ", "founder" => "üöÄ",
    "data" => "üìà", "Îç∞Ïù¥ÌÑ∞" => "üìà", "Î∂ÑÏÑùÍ∞Ä" => "üìà"
  }

  # ÏÇ¨Ïö©Ïûê Ïó≠Ìï†ÏóêÏÑú Ïù¥Î™®ÏßÄ Ï∞æÍ∏∞
  user_role = user.role_title&.downcase || ""
  role_emoji = role_emojis.find { |key, _| user_role.include?(key) }&.last || "üöÄ"

  # 4Í∞ÄÏßÄ ÏÉâÏÉÅ Î≥ÄÌòï (undrew-design Ïä§ÌÉÄÏùº)
  card_colors = [
    { bg: "from-blue-50 to-blue-100/50", border: "border-blue-300", badge_bg: "from-blue-500 to-blue-600", skill_bg: "bg-blue-100", skill_text: "text-blue-700" },
    { bg: "from-purple-50 to-purple-100/50", border: "border-purple-300", badge_bg: "from-purple-500 to-purple-600", skill_bg: "bg-purple-100", skill_text: "text-purple-700" },
    { bg: "from-emerald-50 to-emerald-100/50", border: "border-emerald-300", badge_bg: "from-emerald-500 to-emerald-600", skill_bg: "bg-emerald-100", skill_text: "text-emerald-700" },
    { bg: "from-amber-50 to-amber-100/50", border: "border-amber-300", badge_bg: "from-amber-500 to-amber-600", skill_bg: "bg-amber-100", skill_text: "text-amber-700" }
  ]
  c = card_colors[card_index % 4]
%>

<button type="button"
        class="group text-left cursor-pointer w-full animate-card-lift"
        data-action="click->expert-overlay#show"
        data-expert-overlay-user-id-param="<%= user.id %>"
        data-expert-overlay-score-boost-param="<%= score_boost %>"
        data-expert-overlay-boost-area-param="<%= boost_area %>"
        data-expert-overlay-why-param="<%= why %>">

  <div class="bg-gradient-to-br <%= c[:bg] %> rounded-xl p-5 border-2 <%= c[:border] %> shadow-lg card-hover">

    <%# Ìó§Îçî: ÏïÑÎ∞îÌÉÄ + Ï†êÏàò Î∞∞ÏßÄ %>
    <div class="flex justify-between items-start mb-4">
      <%# ÏïÑÎ∞îÌÉÄ (16x16 = 64px) %>
      <div class="w-16 h-16 rounded-full bg-white shadow-md overflow-hidden border-2 border-white flex-shrink-0">
        <% if user.avatar.attached? %>
          <%= image_tag user.avatar, alt: user.name, class: "w-full h-full object-cover" %>
        <% elsif user.respond_to?(:avatar_url) && user.avatar_url.present? %>
          <%= image_tag user.avatar_url, alt: user.name, class: "w-full h-full object-cover", onerror: "this.style.display='none'; this.nextElementSibling.style.display='flex';" %>
          <div class="w-full h-full bg-gradient-to-br from-slate-200 to-slate-300 hidden items-center justify-center">
            <span class="text-2xl"><%= role_emoji %></span>
          </div>
        <% else %>
          <div class="w-full h-full bg-gradient-to-br from-slate-200 to-slate-300 flex items-center justify-center">
            <span class="text-2xl"><%= role_emoji %></span>
          </div>
        <% end %>
      </div>

      <%# Ï†êÏàò ÏÉÅÏäπ Î∞∞ÏßÄ %>
      <div class="bg-gradient-to-br <%= c[:badge_bg] %> rounded-lg px-3 py-2 shadow-md">
        <div class="flex items-center gap-2 mb-0.5">
          <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 11l5-5m0 0l5 5m-5-5v12"/>
          </svg>
          <span class="font-bold text-white">+<%= score_boost %>Ï†ê</span>
        </div>
        <div class="text-white/80 text-xs"><%= boost_area %> Ìñ•ÏÉÅ</div>
      </div>
    </div>

    <%# Í∏∞Î≥∏ Ï†ïÎ≥¥ %>
    <div class="mb-3">
      <h3 class="font-bold text-slate-800 mb-1 text-lg group-hover:text-blue-600 transition-colors"><%= user.name %></h3>
      <% if user.role_title.present? %>
        <p class="text-slate-600 font-medium"><%= user.role_title %></p>
      <% end %>
    </div>

    <%# Ïä§ÌÇ¨ ÌÉúÍ∑∏ (ÏµúÎåÄ 4Í∞ú) %>
    <% skills = user.respond_to?(:skills_array) ? user.skills_array.first(4) : [] %>
    <% if skills.any? %>
      <div class="flex flex-wrap gap-2 mb-4">
        <% skills.each do |skill| %>
          <span class="bg-white/70 backdrop-blur-sm text-slate-700 px-3 py-1 rounded-md text-sm font-medium">
            <%= truncate(skill, length: 15) %>
          </span>
        <% end %>
      </div>
    <% end %>

    <%# Ï∂îÏ≤ú Ïù¥Ïú† %>
    <p class="text-slate-700 leading-relaxed mb-3 line-clamp-2"><%= why %></p>

    <%# ÌôúÎèô ÏÉÅÌÉú Î±ÉÏßÄ %>
    <% if user.respond_to?(:has_availability_status?) && user.has_availability_status? %>
      <% badge = user.availability_badges.first %>
      <% if badge %>
        <div class="mb-3">
          <span class="inline-flex items-center gap-1.5 rounded-full px-3 py-1 text-xs font-semibold text-white <%= badge[:color] %> shadow-sm">
            <span class="h-1.5 w-1.5 rounded-full bg-white animate-pulse"></span>
            <%= badge[:label] %>
          </span>
        </div>
      <% end %>
    <% end %>

    <%# ÏûêÏÑ∏Ìûà Î≥¥Í∏∞ CTA %>
    <div class="flex items-center justify-between pt-3 border-t border-white/50">
      <span class="text-slate-600 font-medium">ÏûêÏÑ∏Ìûà Î≥¥Í∏∞</span>
      <svg class="w-5 h-5 text-slate-600 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
      </svg>
    </div>
  </div>
</button>
