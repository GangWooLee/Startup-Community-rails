<%# ì¶”ì²œ ì „ë¬¸ê°€ ì¹´ë“œ v2 (Figma ë””ìì¸ - ê·¸ë¼ë””ì–¸íŠ¸ í—¤ë” ìŠ¤íƒ€ì¼) %>
<%# locals: prediction %>

<%
  # prediction êµ¬ì¡°: { user:, score_boost:, boost_area:, why: }
  user = prediction[:user]
  score_boost = prediction[:score_boost] || 10
  boost_area = prediction[:boost_area] || "ì „ë¬¸ì„±"
  why = prediction[:why] || "#{boost_area} ë³´ì™„ì— ì í•©"

  # ì—­í• ë³„ ì´ëª¨ì§€ ë§¤í•‘
  role_emojis = {
    "developer" => "ğŸ’»", "ê°œë°œì" => "ğŸ’»", "ì—”ì§€ë‹ˆì–´" => "ğŸ’»", "engineer" => "ğŸ’»",
    "designer" => "ğŸ¨", "ë””ìì´ë„ˆ" => "ğŸ¨",
    "marketer" => "ğŸ“Š", "ë§ˆì¼€í„°" => "ğŸ“Š", "ë§ˆì¼€íŒ…" => "ğŸ“Š",
    "pm" => "ğŸ“‹", "ê¸°íšì" => "ğŸ“‹", "product manager" => "ğŸ“‹",
    "ceo" => "ğŸš€", "ëŒ€í‘œ" => "ğŸš€", "ì°½ì—…ì" => "ğŸš€", "founder" => "ğŸš€",
    "data" => "ğŸ“ˆ", "ë°ì´í„°" => "ğŸ“ˆ", "ë¶„ì„ê°€" => "ğŸ“ˆ"
  }

  # ì‚¬ìš©ì ì—­í• ì—ì„œ ì´ëª¨ì§€ ì°¾ê¸°
  user_role = user.role_title&.downcase || ""
  role_emoji = role_emojis.find { |key, _| user_role.include?(key) }&.last || "ğŸš€"
%>

<button type="button"
        class="relative bg-card rounded-xl border border-border overflow-hidden text-left hover:border-primary/50 hover:shadow-lg transition-all cursor-pointer group w-full"
        data-action="click->expert-overlay#show"
        data-expert-overlay-user-id-param="<%= user.id %>"
        data-expert-overlay-score-boost-param="<%= score_boost %>"
        data-expert-overlay-boost-area-param="<%= boost_area %>"
        data-expert-overlay-why-param="<%= why %>">

  <!-- ê·¸ë¼ë””ì–¸íŠ¸ í—¤ë” (íŒŒë€ìƒ‰ â†’ ë³´ë¼ìƒ‰) -->
  <div class="bg-gradient-to-r from-blue-500 to-purple-600 px-4 py-3">
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-1.5">
        <svg class="h-4 w-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"/>
        </svg>
        <span class="text-sm font-bold text-white">+<%= score_boost %>ì  ì˜ˆìƒ</span>
      </div>
    </div>
    <p class="text-xs text-white/80 mt-0.5"><%= boost_area %> ì ìˆ˜ í–¥ìƒ</p>
  </div>

  <!-- ì¹´ë“œ ë³¸ë¬¸ -->
  <div class="p-4">
    <!-- ì´ëª¨ì§€ ì•„ë°”íƒ€ + ì´ë¦„ + ì—­í•  -->
    <div class="flex items-center gap-3 mb-3">
      <div class="h-12 w-12 rounded-full overflow-hidden bg-secondary flex items-center justify-center ring-2 ring-white shadow">
        <% if user.avatar.attached? %>
          <%= image_tag user.avatar, alt: user.name, class: "h-full w-full object-cover" %>
        <% elsif user.avatar_url.present? %>
          <%= image_tag user.avatar_url, alt: user.name, class: "h-full w-full object-cover", onerror: "this.style.display='none'; this.nextElementSibling.style.display='flex';" %>
          <span class="text-2xl hidden items-center justify-center"><%= role_emoji %></span>
        <% else %>
          <span class="text-2xl"><%= role_emoji %></span>
        <% end %>
      </div>
      <div class="flex-1 min-w-0">
        <p class="font-semibold text-foreground text-sm truncate group-hover:text-primary transition-colors"><%= user.name %></p>
        <% if user.role_title.present? %>
          <span class="inline-block px-2 py-0.5 bg-secondary rounded text-xs text-muted-foreground truncate max-w-full"><%= user.role_title %></span>
        <% end %>
      </div>
    </div>

    <!-- ì¶”ì²œ ì´ìœ  ì„¹ì…˜ -->
    <div class="mb-3">
      <p class="text-xs font-medium text-muted-foreground mb-1 flex items-center gap-1">
        <span>ğŸ’¡</span> ì¶”ì²œ ì´ìœ 
      </p>
      <p class="text-sm text-foreground leading-relaxed line-clamp-2"><%= why %></p>
    </div>

    <!-- ìŠ¤í‚¬ íƒœê·¸ (ìµœëŒ€ 3ê°œ) -->
    <% skills = user.skills_array.first(3) %>
    <% if skills.any? %>
      <div class="flex flex-wrap gap-1 mb-3">
        <% skills.each do |skill| %>
          <span class="px-2 py-0.5 text-[10px] rounded-full bg-primary/10 text-primary truncate max-w-[80px]" title="<%= skill %>">
            <%= truncate(skill, length: 12) %>
          </span>
        <% end %>
      </div>
    <% end %>

    <!-- í™œë™ ìƒíƒœ ë±ƒì§€ -->
    <% if user.has_availability_status? %>
      <% badge = user.availability_badges.first %>
      <% if badge %>
        <div class="mb-3">
          <span class="inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-[10px] font-medium text-white <%= badge[:color] %>">
            <span class="h-1 w-1 rounded-full bg-white animate-pulse"></span>
            <%= badge[:label] %>
          </span>
        </div>
      <% end %>
    <% end %>

    <!-- CTA ë§í¬ -->
    <div class="pt-2 border-t border-border">
      <span class="text-xs text-primary font-medium flex items-center gap-1 group-hover:underline">
        í´ë¦­í•˜ì—¬ ìì„¸íˆ ë³´ê¸°
        <svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
      </span>
    </div>
  </div>
</button>
