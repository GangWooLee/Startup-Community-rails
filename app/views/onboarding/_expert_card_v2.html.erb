<%# ì¶”ì²œ ì „ë¬¸ê°€ ì¹´ë“œ v2 - Undrew Design System Style %>
<%# locals: prediction, card_index %>

<%
  # prediction êµ¬ì¡°: { user:, score_boost:, boost_area:, why: }
  user = prediction[:user]
  score_boost = prediction[:score_boost] || 10
  boost_area = prediction[:boost_area] || "ì „ë¬¸ì„±"
  why = prediction[:why] || "#{boost_area} ë³´ì™„ì— ì í•©"
  card_index ||= 0

  # ì—­í• ë³„ ì´ëª¨ì§€ ë§¤í•‘
  role_emojis = {
    "developer" => "ğŸ’»", "ê°œë°œì" => "ğŸ’»", "ì—”ì§€ë‹ˆì–´" => "ğŸ’»", "engineer" => "ğŸ’»",
    "designer" => "ğŸ¨", "ë””ìì´ë„ˆ" => "ğŸ¨",
    "marketer" => "ğŸ“Š", "ë§ˆì¼€í„°" => "ğŸ“Š", "ë§ˆì¼€íŒ…" => "ğŸ“Š",
    "pm" => "ğŸ“‹", "ê¸°íšì" => "ğŸ“‹", "product manager" => "ğŸ“‹",
    "ceo" => "ğŸš€", "ëŒ€í‘œ" => "ğŸš€", "ì°½ì—…ì" => "ğŸš€", "founder" => "ğŸš€",
    "data" => "ğŸ“ˆ", "ë°ì´í„°" => "ğŸ“ˆ", "ë¶„ì„ê°€" => "ğŸ“ˆ"
  }

  # ì‚¬ìš©ì ì—­í• ì—ì„œ ì´ëª¨ì§€ ì°¾ê¸°
  user_role = user.role_title&.downcase || ""
  role_emoji = role_emojis.find { |key, _| user_role.include?(key) }&.last || "ğŸš€"

  # 4ê°€ì§€ ìƒ‰ìƒ ë³€í˜• (undrew-design ìŠ¤íƒ€ì¼)
  card_colors = [
    { bg: "from-blue-50 to-blue-100/50", border: "border-blue-300", badge_bg: "from-blue-500 to-blue-600", skill_bg: "bg-blue-100", skill_text: "text-blue-700" },
    { bg: "from-purple-50 to-purple-100/50", border: "border-purple-300", badge_bg: "from-purple-500 to-purple-600", skill_bg: "bg-purple-100", skill_text: "text-purple-700" },
    { bg: "from-emerald-50 to-emerald-100/50", border: "border-emerald-300", badge_bg: "from-emerald-500 to-emerald-600", skill_bg: "bg-emerald-100", skill_text: "text-emerald-700" },
    { bg: "from-amber-50 to-amber-100/50", border: "border-amber-300", badge_bg: "from-amber-500 to-amber-600", skill_bg: "bg-amber-100", skill_text: "text-amber-700" }
  ]
  c = card_colors[card_index % 4]
%>

<button type="button"
        class="group text-left cursor-pointer w-full h-full animate-card-lift"
        data-action="click->expert-overlay#show"
        data-expert-overlay-user-id-param="<%= user.id %>"
        data-expert-overlay-score-boost-param="<%= score_boost %>"
        data-expert-overlay-boost-area-param="<%= boost_area %>"
        data-expert-overlay-why-param="<%= why %>">

  <div class="bg-gradient-to-br <%= c[:bg] %> rounded-xl p-5 border-2 <%= c[:border] %> shadow-lg card-hover h-full flex flex-col">

    <%# í—¤ë”: ì•„ë°”íƒ€ + ì ìˆ˜ ë°°ì§€ %>
    <div class="flex justify-between items-start mb-4">
      <%# ì•„ë°”íƒ€ (16x16 = 64px) - render_user_avatar í—¬í¼ë¡œ ìµëª… ì²˜ë¦¬ ì§€ì› %>
      <%= render_user_avatar(user, size: "xl", ring: "border-2 border-white", class: "shadow-md") %>

      <%# ì ìˆ˜ ìƒìŠ¹ ë°°ì§€ %>
      <div class="bg-gradient-to-br <%= c[:badge_bg] %> rounded-lg px-3 py-2 shadow-md">
        <div class="flex items-center gap-2 mb-0.5">
          <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 11l5-5m0 0l5 5m-5-5v12"/>
          </svg>
          <span class="font-bold text-white">+<%= score_boost %>ì </span>
        </div>
        <div class="text-white/80 text-xs"><%= boost_area %> í–¥ìƒ</div>
      </div>
    </div>

    <%# ê¸°ë³¸ ì •ë³´ %>
    <div class="mb-3">
      <h3 class="font-bold text-slate-800 mb-1 text-lg group-hover:text-blue-600 transition-colors"><%= user.display_name %></h3>
      <% if user.role_title.present? %>
        <p class="text-slate-600 font-medium"><%= user.role_title %></p>
      <% end %>
    </div>

    <%# ìŠ¤í‚¬ íƒœê·¸ (ìµœëŒ€ 4ê°œ) %>
    <% skills = user.respond_to?(:skills_array) ? user.skills_array.first(4) : [] %>
    <% if skills.any? %>
      <div class="flex flex-wrap gap-2 mb-4">
        <% skills.each do |skill| %>
          <span class="bg-white/70 backdrop-blur-sm text-slate-700 px-3 py-1 rounded-md text-sm font-medium">
            <%= truncate(skill, length: 15) %>
          </span>
        <% end %>
      </div>
    <% end %>

    <%# ì¶”ì²œ ì´ìœ  %>
    <p class="text-slate-700 leading-relaxed mb-3 line-clamp-2 flex-grow"><%= why %></p>

    <%# í™œë™ ìƒíƒœ ë±ƒì§€ %>
    <% if user.respond_to?(:has_availability_status?) && user.has_availability_status? %>
      <% badge = user.availability_badges.first %>
      <% if badge %>
        <div class="mb-3">
          <span class="inline-flex items-center gap-1.5 rounded-full px-3 py-1 text-xs font-semibold text-white <%= badge[:color] %> shadow-sm">
            <span class="h-1.5 w-1.5 rounded-full bg-white animate-pulse"></span>
            <%= badge[:label] %>
          </span>
        </div>
      <% end %>
    <% end %>

    <%# ìì„¸íˆ ë³´ê¸° CTA %>
    <div class="flex items-center justify-between pt-3 border-t border-white/50">
      <span class="text-slate-600 font-medium">ìì„¸íˆ ë³´ê¸°</span>
      <svg class="w-5 h-5 text-slate-600 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
      </svg>
    </div>
  </div>
</button>
