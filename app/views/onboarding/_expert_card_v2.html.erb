<%# 추천 전문가 카드 v2 (2x2 그리드용, 점수 향상 예측 포함) %>
<%# locals: prediction %>

<%
  # prediction 구조: { user:, score_boost:, boost_area:, why: }
  user = prediction[:user]
  score_boost = prediction[:score_boost] || 10
  boost_area = prediction[:boost_area] || "전문성"
  why = prediction[:why] || "#{boost_area} 보완에 적합"
%>

<button type="button"
        class="relative bg-card rounded-xl border border-border p-4 text-left hover:border-primary/50 hover:shadow-lg transition-all cursor-pointer group"
        data-action="click->expert-overlay#show"
        data-expert-overlay-user-id-param="<%= user.id %>">

  <!-- 점수 향상 예측 배지 -->
  <div class="absolute -top-2 -right-2 z-10">
    <div class="bg-gradient-to-r from-cyan-500 to-primary px-2 py-1 rounded-full shadow-lg">
      <span class="text-xs font-bold text-white">+<%= score_boost %>점</span>
    </div>
  </div>

  <!-- 아바타 -->
  <div class="flex justify-center mb-3">
    <div class="h-14 w-14 rounded-full overflow-hidden bg-secondary flex items-center justify-center ring-2 ring-white shadow group-hover:ring-primary/30 transition-all">
      <% if user.avatar.attached? %>
        <%= image_tag user.avatar, alt: user.name, class: "h-full w-full object-cover" %>
      <% elsif user.avatar_url.present? %>
        <%= image_tag user.avatar_url, alt: user.name, class: "h-full w-full object-cover", onerror: "this.style.display='none'; this.nextElementSibling.style.display='flex';" %>
        <span class="text-lg font-semibold text-muted-foreground hidden items-center justify-center"><%= user.name&.first&.upcase || "?" %></span>
      <% else %>
        <span class="text-lg font-semibold text-muted-foreground"><%= user.name&.first&.upcase || "?" %></span>
      <% end %>
    </div>
  </div>

  <!-- 이름 & 역할 -->
  <div class="text-center mb-2">
    <p class="font-semibold text-foreground text-sm truncate group-hover:text-primary transition-colors"><%= user.name %></p>
    <% if user.role_title.present? %>
      <p class="text-xs text-muted-foreground truncate"><%= user.role_title %></p>
    <% end %>
  </div>

  <!-- Why 설명 (점수 향상 이유) -->
  <div class="bg-secondary/50 rounded-lg p-2 mb-2">
    <p class="text-[11px] text-muted-foreground text-center leading-tight line-clamp-2">
      <span class="text-primary font-medium"><%= boost_area %></span> 보완에 적합
    </p>
  </div>

  <!-- 스킬 태그 (최대 2개) -->
  <% skills = user.skills_array.first(2) %>
  <% if skills.any? %>
    <div class="flex flex-wrap gap-1 justify-center">
      <% skills.each do |skill| %>
        <span class="px-2 py-0.5 text-[10px] rounded-full bg-primary/10 text-primary truncate max-w-[70px]" title="<%= skill %>">
          <%= truncate(skill, length: 10) %>
        </span>
      <% end %>
    </div>
  <% end %>

  <!-- 활동 상태 뱃지 -->
  <% if user.has_availability_status? %>
    <div class="flex justify-center mt-2">
      <% badge = user.availability_badges.first %>
      <% if badge %>
        <span class="inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-[10px] font-medium text-white <%= badge[:color] %>">
          <span class="h-1 w-1 rounded-full bg-white animate-pulse"></span>
          <%= badge[:label] %>
        </span>
      <% end %>
    </div>
  <% end %>
</button>
