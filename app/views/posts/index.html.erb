<% content_for :head do %>
  <meta name="turbo-cache-control" content="no-cache">
<% end %>

<div class="min-h-screen bg-background pb-20">
  <!-- Header -->
  <header class="sticky top-0 bg-background/95 backdrop-blur-sm border-b border-border z-40">
    <div class="max-w-screen-xl mx-auto px-4 py-3">
      <div class="flex items-center justify-between">
        <!-- Left: Logo & Title -->
        <div>
          <h1 class="text-xl font-bold text-foreground">Grounded</h1>
          <p class="text-xs text-muted-foreground">창업자들의 커뮤니티</p>
        </div>

        <!-- Right: Action Icons -->
        <div class="flex items-center gap-1">
          <!-- 검색 -->
          <button type="button" class="p-2 rounded-full hover:bg-secondary transition-colors" title="검색">
            <svg class="h-5 w-5 text-muted-foreground hover:text-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
            </svg>
          </button>

          <!-- 알림 -->
          <button type="button" class="p-2 rounded-full hover:bg-secondary transition-colors relative" title="알림">
            <svg class="h-5 w-5 text-muted-foreground hover:text-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
            </svg>
            <!-- 알림 뱃지 (추후 알림 기능 구현 시 활성화) -->
            <%# <span class="absolute top-1 right-1 h-2 w-2 bg-destructive rounded-full"></span> %>
          </button>

          <!-- 마이페이지 / 로그인 -->
          <% if logged_in? %>
            <%= link_to my_page_path, class: "ml-2 flex items-center gap-2 px-3 py-1.5 rounded-full bg-secondary hover:bg-secondary/80 transition-colors", title: "마이페이지" do %>
              <div class="h-6 w-6 rounded-full overflow-hidden bg-muted flex items-center justify-center">
                <% if current_user.avatar.attached? %>
                  <%= image_tag current_user.avatar, alt: current_user.name, class: "h-full w-full object-cover" %>
                <% elsif current_user.avatar_url.present? %>
                  <%= image_tag current_user.avatar_url, alt: current_user.name, class: "h-full w-full object-cover" %>
                <% else %>
                  <span class="text-xs font-semibold text-muted-foreground"><%= current_user.name[0] %></span>
                <% end %>
              </div>
              <span class="text-sm font-medium text-foreground">MY</span>
            <% end %>
          <% else %>
            <%= link_to login_path, class: "ml-2 flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-primary text-primary-foreground text-sm font-medium hover:bg-primary/90 transition-colors", title: "로그인" do %>
              <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
              </svg>
              로그인
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="max-w-screen-xl mx-auto px-4 py-6">
    <% if @posts.empty? %>
      <div class="text-center py-12">
        <svg class="h-12 w-12 mx-auto text-muted-foreground mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
        </svg>
        <p class="text-muted-foreground">아직 게시글이 없습니다</p>
        <p class="text-sm text-muted-foreground mt-1">첫 번째 글을 작성해보세요!</p>
      </div>
    <% else %>
      <div class="space-y-4">
        <% @posts.each do |post| %>
          <%= render partial: "posts/community_post_card", locals: { post: post } %>
        <% end %>
      </div>
    <% end %>
  </main>

  <%= render "shared/bottom_nav" %>
</div>
