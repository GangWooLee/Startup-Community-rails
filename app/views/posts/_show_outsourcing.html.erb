<%#
  Outsourcing Post Detail - "The Portfolio Magazine" Style
  Reference: Bento Grid + Split Layout (8:4)

  Ïª®ÏÖâ: Ï†ïÎ≥¥Î•º 'Î≥¥Ïó¨Ï£ºÎäî' Í≤ÉÏù¥ ÏïÑÎãàÎùº 'ÌåêÎß§(Sell)'ÌïòÎäî ÎîîÏûêÏù∏
  Î™©Ìëú: "Ïù¥ ÏÇ¨ÎûåÍ≥º ÏùºÌïòÍ≥† Ïã∂Îã§", "Ïù¥ ÌîÑÎ°úÏ†ùÌä∏Ïóê ÏßÄÏõêÌïòÍ≥† Ïã∂Îã§"Îäî ÏöïÍµ¨ Ïú†Î∞ú
%>

<div class="min-h-screen bg-gradient-to-b from-stone-50 to-white" data-controller="report-modal">

  <%# ===== Sticky Header (Compact) ===== %>
  <header class="sticky top-0 bg-white/95 backdrop-blur-sm border-b border-stone-200/60 z-40">
    <div class="max-w-6xl mx-auto px-6 py-3 flex items-center gap-3">
      <%# Drawbridge Task #122: Í≥ÑÏ∏µÌòï Í≥†Ï†ï ÎßÅÌÅ¨ Î∞©Ïãù - Ìï≠ÏÉÅ Î™©Î°ù ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô %>
      <%= link_to job_posts_path, class: "p-2 rounded-lg text-stone-500 hover:text-stone-700 hover:bg-stone-100 transition-colors" do %>
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
      <% end %>

      <nav class="flex items-center gap-2 text-sm text-stone-500">
        <%= link_to "Join Project", job_posts_path, class: "hover:text-stone-700 transition-colors" %>
        <span>/</span>
        <span class="font-medium text-stone-900"><%= post.hiring? ? "Makers" : "Projects" %></span>
      </nav>

      <div class="ml-auto flex items-center gap-2">
        <% if logged_in? && post.user == current_user %>
          <%= link_to edit_post_path(post), class: "px-3 py-1.5 text-sm font-medium text-stone-600
                       hover:text-stone-900 hover:bg-stone-100 rounded-lg transition-colors" do %>
            ÏàòÏ†ï
          <% end %>
        <% elsif logged_in? && post.user != current_user %>
          <%# Report dropdown %>
          <div class="relative" data-controller="dropdown" data-testid="post-actions-dropdown">
            <button type="button"
                    class="p-2 rounded-lg text-stone-400 hover:text-stone-600 hover:bg-stone-100 transition-colors"
                    data-action="click->dropdown#toggle">
              <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"/>
              </svg>
            </button>
            <div class="hidden absolute right-0 mt-2 w-40 rounded-xl shadow-lg bg-white border border-stone-200 z-50"
                 data-dropdown-target="menu">
              <div class="py-1">
                <button type="button"
                        class="w-full text-left px-4 py-2.5 text-sm text-red-600 hover:bg-red-50 flex items-center gap-2 transition-colors"
                        data-action="click->report-modal#open"
                        data-reportable-type="Post"
                        data-reportable-id="<%= post.id %>"
                        data-target-name="<%= post.title.truncate(20) %>">
                  <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                  </svg>
                  Ïã†Í≥†ÌïòÍ∏∞
                </button>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </header>

  <%# ===== Main Content ===== %>
  <main class="max-w-6xl mx-auto px-6 py-8 pb-32 lg:pb-8">

    <%# ===== Hero Section: Cover + Floating Avatar ===== %>
    <section class="mb-8">
      <%# Cover Image Area %>
      <div class="relative h-48 md:h-56 rounded-3xl overflow-hidden">
        <% if post.images.attached? %>
          <%= image_tag post.images.first, class: "w-full h-full object-cover" %>
          <div class="absolute inset-0 bg-gradient-to-t from-black/30 to-transparent"></div>
        <% else %>
          <%# Gradient fallback with decorative elements %>
          <div class="w-full h-full bg-gradient-to-br from-orange-100 via-amber-50 to-stone-100 relative">
            <div class="absolute -right-16 -bottom-16 w-64 h-64 bg-orange-200/40 rounded-full blur-3xl"></div>
            <div class="absolute -left-8 top-8 w-32 h-32 bg-amber-200/30 rounded-full blur-2xl"></div>
            <%# Pattern decoration %>
            <div class="absolute inset-0 opacity-[0.03]"
                 style="background-image: url('data:image/svg+xml,%3Csvg width=\'60\' height=\'60\' viewBox=\'0 0 60 60\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cg fill=\'none\' fill-rule=\'evenodd\'%3E%3Cg fill=\'%23000\' fill-opacity=\'1\'%3E%3Cpath d=\'M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z\'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');"></div>
          </div>
        <% end %>

        <%# Category Badge (top-left) %>
        <div class="absolute top-4 left-4 flex items-center gap-2">
          <span class="px-3 py-1.5 rounded-full text-xs font-bold
                       <%= post.hiring? ? 'bg-[#2C2825] text-white' : 'bg-orange-500 text-white' %>">
            <%= post.hiring? ? "Makers" : "Projects" %>
          </span>
          <% if post.service_type.present? %>
            <span class="px-3 py-1.5 rounded-full text-xs font-medium bg-white/90 text-stone-700 backdrop-blur-sm">
              <%= post.service_type_label %>
            </span>
          <% end %>
        </div>
      </div>

      <%# Floating Avatar + Title - Drawbridge Task #106: Í∞ÄÎ°ú Î∞∞Ïπò Î†àÏù¥ÏïÑÏõÉ %>
      <%# Drawbridge Task #115: ÌîÑÎ°úÌïÑ Î∞ïÏä§ Ï†úÍ±∞ (border-4 ‚Üí ring-2 ÏñáÏùÄ ÌÖåÎëêÎ¶¨) %>
      <%# Drawbridge Task #116: Ïù∏Ï¶ùÎê® Ïª®ÌÖåÏù¥ÎÑà ÏÇ≠Ï†ú %>
      <div class="relative px-4 md:px-8">
        <%# Avatar - ÌîÑÎ°úÌïÑÎßå ÌëúÏãú %>
        <%# Drawbridge Task #120: ring-2 ÌÖåÎëêÎ¶¨ Ï†úÍ±∞, ÌîÑÎ°úÌïÑÎßå ÍπîÎÅîÌïòÍ≤å %>
        <%# Task #152: Ïô∏Î∂Ä Ïª®ÌÖåÏù¥ÎÑàÎ•º Ìó¨Ìçº ÌÅ¨Í∏∞(2xl=80px)ÏôÄ ÏùºÏπò %>
        <div class="-mt-12 mb-4">
          <div class="w-20 h-20 rounded-full overflow-hidden bg-white shadow-md">
            <%= render_user_avatar(post.user, size: "2xl") %>
          </div>
        </div>

        <%# Title & Meta %>
        <h1 class="text-2xl md:text-3xl font-bold text-stone-900 leading-tight mb-3">
          <%= post.title %>
        </h1>
        <div class="flex flex-wrap items-center gap-x-3 gap-y-1 text-sm text-stone-500">
          <%= link_to profile_path(post.user), class: "font-medium text-stone-700 hover:text-orange-600 transition-colors" do %>
            <%= post.user.name %>
          <% end %>
          <span class="text-stone-300">‚Ä¢</span>
          <span><%= time_ago_in_words(post.created_at) %> Ï†Ñ</span>
          <span class="text-stone-300">‚Ä¢</span>
          <span>Ï°∞Ìöå <%= number_with_delimiter(post.views_count) %></span>
        </div>
      </div>
    </section>

    <%# ===== 2-Column Split Layout ===== %>
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">

      <%# ===== LEFT: Main Content (8 cols) ===== %>
      <div class="lg:col-span-8 space-y-8">

        <%# Bento Summary Grid %>
        <%# Drawbridge Task #117: Î∞∞Í≤ΩÏÉâ ÏßÑÌïòÍ≤å (bg-stone-50 ‚Üí bg-stone-100) %>
        <section class="grid grid-cols-3 gap-3">
          <%# Budget Card %>
          <div class="bg-stone-100 rounded-2xl p-4 flex flex-col items-center text-center">
            <div class="w-10 h-10 rounded-xl bg-stone-200 flex items-center justify-center mb-2">
              <svg class="w-5 h-5 text-stone-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
            </div>
            <span class="text-xs text-stone-500 mb-1">ÏòàÏÇ∞</span>
            <span class="text-lg font-bold text-stone-900"><%= post.price_display %></span>
            <% if post.price_negotiable? %>
              <span class="text-[10px] text-orange-600 mt-0.5 font-medium">ÌòëÏùò Í∞ÄÎä•</span>
            <% end %>
          </div>

          <%# Duration Card %>
          <div class="bg-stone-100 rounded-2xl p-4 flex flex-col items-center text-center">
            <div class="w-10 h-10 rounded-xl bg-stone-200 flex items-center justify-center mb-2">
              <svg class="w-5 h-5 text-stone-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
              </svg>
            </div>
            <span class="text-xs text-stone-500 mb-1">Í∏∞Í∞Ñ</span>
            <span class="text-lg font-bold text-stone-900"><%= post.work_period.presence || "ÌòëÏùò" %></span>
          </div>

          <%# Work Type Card (Accent) %>
          <div class="bg-orange-50 rounded-2xl p-4 flex flex-col items-center text-center">
            <div class="w-10 h-10 rounded-xl bg-orange-100 flex items-center justify-center mb-2">
              <svg class="w-5 h-5 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
              </svg>
            </div>
            <span class="text-xs text-stone-500 mb-1">Í∑ºÎ¨¥Î∞©Ïãù</span>
            <span class="text-lg font-bold text-stone-900"><%= post.work_type_label.presence || "ÌòëÏùò" %></span>
          </div>
        </section>

        <%# Tech Stack (Visual Icons) %>
        <% if post.skills.present? %>
          <section>
            <h3 class="text-sm font-bold text-stone-700 mb-3 flex items-center gap-2">
              <svg class="w-4 h-4 text-stone-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/>
              </svg>
              <%= post.hiring? ? "ÌïÑÏöî Í∏∞Ïà†" : "Î≥¥Ïú† Í∏∞Ïà†" %>
            </h3>
            <div class="flex flex-wrap gap-2">
              <% post.skills_array.each do |skill| %>
                <div class="inline-flex items-center gap-2 px-3 py-2 rounded-xl
                            bg-white border border-stone-200 shadow-sm hover:shadow-md transition-shadow">
                  <img src="<%= devicon_url(skill) %>"
                       alt="<%= skill %>"
                       class="w-5 h-5"
                       onerror="this.style.display='none'">
                  <span class="text-sm font-medium text-stone-700"><%= skill %></span>
                </div>
              <% end %>
            </div>
          </section>
        <% end %>

        <%# Description %>
        <section class="bg-white rounded-2xl border border-stone-200/60 p-6">
          <h3 class="text-sm font-bold text-stone-700 mb-4 flex items-center gap-2">
            <svg class="w-4 h-4 text-stone-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
            </svg>
            ÏÉÅÏÑ∏ ÏÑ§Î™Ö
          </h3>
          <div class="prose prose-stone prose-sm max-w-none">
            <p class="text-stone-700 leading-relaxed whitespace-pre-wrap"><%= post.content %></p>
          </div>
        </section>

        <%# Experience (Seeking only) %>
        <% if post.seeking? && post.experience.present? %>
          <section class="bg-white rounded-2xl border border-stone-200/60 p-6">
            <h3 class="text-sm font-bold text-stone-700 mb-4 flex items-center gap-2">
              <svg class="w-4 h-4 text-stone-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
              </svg>
              Í¥ÄÎ†® Í≤ΩÌóò/Ïù¥Î†•
            </h3>
            <p class="text-stone-700 leading-relaxed whitespace-pre-wrap bg-stone-50 rounded-xl p-4">
              <%= post.experience %>
            </p>
          </section>
        <% end %>

        <%# Portfolio Link (Rich Preview) %>
        <% if post.seeking? && post.portfolio_url.present? %>
          <section>
            <h3 class="text-sm font-bold text-stone-700 mb-3 flex items-center gap-2">
              <svg class="w-4 h-4 text-stone-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/>
              </svg>
              Ìè¨Ìä∏Ìè¥Î¶¨Ïò§
            </h3>

            <% if safe_url?(post.portfolio_url) %>
              <a href="<%= post.portfolio_url %>"
                 target="_blank"
                 rel="noopener noreferrer"
                 class="block rounded-2xl border border-stone-200 overflow-hidden
                        hover:border-orange-300 hover:shadow-lg transition-all group">
                <div class="flex">
                  <%# Thumbnail placeholder %>
                  <div class="w-32 h-24 bg-gradient-to-br from-stone-100 to-stone-50 flex-shrink-0
                              flex items-center justify-center">
                    <svg class="w-8 h-8 text-stone-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                            d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                    </svg>
                  </div>

                  <%# Content %>
                  <div class="flex-1 p-4">
                    <p class="text-sm font-semibold text-stone-900 group-hover:text-orange-600 transition-colors line-clamp-1">
                      <%= URI.parse(post.portfolio_url).host rescue "Ìè¨Ìä∏Ìè¥Î¶¨Ïò§" %>
                    </p>
                    <p class="text-xs text-stone-500 mt-1 line-clamp-2">
                      Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ ÎßÅÌÅ¨Î•º ÌôïÏù∏Ìï¥Î≥¥ÏÑ∏Ïöî
                    </p>
                    <p class="text-xs text-stone-400 mt-2 truncate flex items-center gap-1">
                      <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                      </svg>
                      <%= post.portfolio_url.truncate(50) %>
                    </p>
                  </div>
                </div>
              </a>
            <% else %>
              <div class="text-sm text-stone-400 bg-stone-50 rounded-xl p-4">
                Ïú†Ìö®ÌïòÏßÄ ÏïäÏùÄ URLÏûÖÎãàÎã§
              </div>
            <% end %>
          </section>
        <% end %>

        <%# Images (if more than 1) %>
        <% if post.images.attached? && post.images.count > 1 %>
          <section>
            <h3 class="text-sm font-bold text-stone-700 mb-3 flex items-center gap-2">
              <svg class="w-4 h-4 text-stone-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
              </svg>
              Ï≤®Î∂Ä Ïù¥ÎØ∏ÏßÄ
            </h3>
            <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
              <% post.images.each_with_index do |image, index| %>
                <% next if index == 0 %> <%# Skip first image (used as cover) %>
                <%= image_tag image, class: "w-full aspect-square object-cover rounded-xl cursor-pointer
                              hover:opacity-90 transition-opacity", alt: "Ï≤®Î∂Ä Ïù¥ÎØ∏ÏßÄ #{index + 1}" %>
              <% end %>
            </div>
          </section>
        <% end %>

        <%# Similar Projects - The Curated Section %>
        <% if similar_posts.present? && similar_posts.any? %>
          <section class="-mx-6 px-6 py-10 mt-8 rounded-3xl
                          bg-gradient-to-b from-[#F9F9F8] to-stone-100/80">
            <%# Warm Header %>
            <div class="text-center mb-8">
              <div class="inline-flex items-center gap-2 mb-3 px-4 py-1.5 rounded-full
                          bg-orange-100/50 text-orange-600 text-xs font-bold">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                </svg>
                Ï∂îÏ≤ú
              </div>
              <h2 class="text-xl md:text-2xl font-bold text-stone-800 mb-2">
                üëÄ Ïù¥ Î∂ÑÏïºÏùò Îã§Î•∏ Í∏∞ÌöåÎèÑ ÎÜìÏπòÏßÄ ÎßàÏÑ∏Ïöî
              </h2>
              <p class="text-sm text-stone-500">
                <%= post.service_type_label.presence || (post.hiring? ? "Makers" : "Projects") %> Î∂ÑÏïºÏùò Îã§Î•∏ ÌîÑÎ°úÏ†ùÌä∏
              </p>
            </div>

            <%# 2-Column Grid - Drawbridge Task #107: Ïπ¥ÎìúÍ∞Ä ÎÑàÎ¨¥ Ï¢ÅÏïÑÏÑú 2Ïó¥Î°ú Î≥ÄÍ≤Ω %>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
              <% similar_posts.limit(6).each do |similar| %>
                <%= render partial: "job_posts/job_card", locals: { post: similar } %>
              <% end %>
            </div>

            <%# Drawbridge Task #114: Ï†ÑÏ≤¥ Í≥µÍ≥† Î≥¥Í∏∞ ÎßÅÌÅ¨ ÏÇ≠Ï†ú %>
          </section>
        <% end %>

        <%# Comments Section %>
        <section class="bg-white rounded-2xl border border-stone-200/60 overflow-hidden">
          <div class="px-6 py-4 border-b border-stone-100 bg-stone-50/50">
            <h3 class="font-bold text-stone-900 flex items-center gap-2">
              <svg class="w-5 h-5 text-stone-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
              </svg>
              ÎåìÍ∏Ä <span id="comments-count" class="text-orange-600"><%= post.comments_count %></span>Í∞ú
            </h3>
          </div>

          <div class="p-6">
            <%# Comment Form %>
            <% if logged_in? %>
              <div class="pb-4 border-b border-stone-100 mb-4">
                <%= render partial: "comments/form", locals: { post: post } %>
              </div>
            <% else %>
              <div class="pb-4 border-b border-stone-100 mb-4">
                <div class="text-center py-4 bg-stone-50 rounded-xl">
                  <p class="text-sm text-stone-500 mb-2">ÎåìÍ∏ÄÏùÑ ÏûëÏÑ±ÌïòÎ†§Î©¥ Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§</p>
                  <%= link_to "Î°úÍ∑∏Ïù∏", login_path, class: "text-sm font-medium text-orange-600 hover:text-orange-700" %>
                </div>
              </div>
            <% end %>

            <%# Comments List %>
            <div id="comments-list" class="divide-y divide-stone-100">
              <% if comments.any? %>
                <% comments.each do |comment| %>
                  <%= render partial: "comments/comment", locals: {
                    comment: comment,
                    post: post,
                    current_user: current_user,
                    depth: 0
                  } %>
                <% end %>
              <% end %>
            </div>

            <% if comments.empty? %>
              <div id="comments-empty" class="text-center py-12 text-stone-400">
                <svg class="w-12 h-12 mx-auto mb-3 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                        d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                </svg>
                <p class="font-medium">ÏïÑÏßÅ ÎåìÍ∏ÄÏù¥ ÏóÜÏäµÎãàÎã§</p>
                <p class="text-sm mt-1">Ï≤´ ÎåìÍ∏ÄÏùÑ ÏûëÏÑ±Ìï¥Î≥¥ÏÑ∏Ïöî!</p>
              </div>
            <% end %>
          </div>
        </section>
      </div>

      <%# ===== RIGHT: Sticky Sidebar - Trust & Action Hub ===== %>
      <aside class="hidden lg:block lg:col-span-4">
        <div class="sticky top-24">

          <%# Unified Trust & Action Card %>
          <div class="bg-white rounded-[24px] p-6
                      shadow-[0_20px_40px_rgba(0,0,0,0.08)]
                      border border-stone-100">

            <%# Urgency Badge %>
            <div class="flex items-center justify-between mb-5">
              <% if post.created_at > 3.days.ago %>
                <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-bold
                             bg-blue-50 text-blue-600">
                  <span class="w-1.5 h-1.5 rounded-full bg-blue-500 animate-pulse"></span>
                  NEW
                </span>
              <% elsif post.seeking? && post.available_now? %>
                <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-bold
                             bg-emerald-50 text-emerald-600">
                  <span class="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"></span>
                  Ï¶âÏãú ÏãúÏûë Í∞ÄÎä•
                </span>
              <% else %>
                <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-bold
                             bg-orange-50 text-orange-600">
                  Î™®ÏßëÏ§ë
                </span>
              <% end %>

              <span class="text-xs text-stone-400">
                <%= time_ago_in_words(post.created_at) %> Ï†Ñ Îì±Î°ù
              </span>
            </div>

            <%# Price & Period - Large Display %>
            <div class="text-center py-6 mb-5 bg-gradient-to-br from-stone-50 to-stone-100/50 rounded-2xl">
              <div class="text-3xl font-bold text-stone-900 mb-1">
                <%= post.price_display %>
              </div>
              <% if post.work_period.present? %>
                <div class="text-sm text-stone-500">
                  ÏòàÏÉÅ Í∏∞Í∞Ñ: <span class="font-medium text-stone-700"><%= post.work_period %></span>
                </div>
              <% end %>
              <% if post.price_negotiable? %>
                <span class="inline-block mt-2 text-xs font-medium text-orange-600 bg-orange-50 px-2 py-0.5 rounded-full">
                  ÌòëÏùò Í∞ÄÎä•
                </span>
              <% end %>
            </div>

            <%# CTA Button with Description %>
            <div class="mb-5">
              <% if logged_in? && !post.owned_by?(current_user) %>
                <%= button_to start_chat_from_post_path(post),
                              method: :post,
                              class: "w-full py-4 rounded-2xl font-bold text-lg text-center
                                     bg-[#2C2825] text-white hover:bg-stone-800
                                     transition-all shadow-md hover:shadow-lg
                                     flex flex-col items-center justify-center gap-1" do %>
                  <span><%= post.hiring? ? "Ìï©Î•ò Ï†úÏïàÌïòÍ∏∞" : "ÌîÑÎ°úÏ†ùÌä∏ Ï†úÏïàÌïòÍ∏∞" %></span>
                  <span class="text-xs font-normal text-white/70">
                    <%= post.hiring? ? "ÌîÑÎ°úÏ†ùÌä∏Ïóê Ï∞∏Ïó¨ ÏùòÏÇ¨Î•º Ï†ÑÎã¨Ìï©ÎãàÎã§" : "ÌòëÏóÖÏùÑ Ï†úÏïàÌï©ÎãàÎã§" %>
                  </span>
                <% end %>
              <% elsif !logged_in? %>
                <%= link_to login_path(return_to: post_path(post)),
                    class: "w-full py-4 rounded-2xl font-bold text-lg text-center block
                           bg-[#2C2825] text-white hover:bg-stone-800
                           transition-all shadow-md hover:shadow-lg" do %>
                  Î°úÍ∑∏Ïù∏ ÌõÑ <%= post.hiring? ? "Ìï©Î•ò Ï†úÏïà" : "ÌîÑÎ°úÏ†ùÌä∏ Ï†úÏïà" %>
                <% end %>
              <% else %>
                <%# Own post %>
                <div class="text-center py-4 text-stone-500 text-sm bg-stone-50 rounded-2xl">
                  ÎÇ¥Í∞Ä ÏûëÏÑ±Ìïú Í≥µÍ≥†ÏûÖÎãàÎã§
                </div>
              <% end %>

              <%# Payment Button %>
              <% if payment_enabled? && post.payable? %>
                <% if logged_in? && !post.owned_by?(current_user) %>
                  <% if post.paid_by?(current_user) %>
                    <div class="w-full mt-3 py-3 rounded-xl text-center bg-emerald-50 text-emerald-700 font-medium flex items-center justify-center gap-2">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                      </svg>
                      Í≤∞Ï†ú ÏôÑÎ£å
                    </div>
                  <% else %>
                    <%= link_to new_payment_path(post_id: post),
                        class: "w-full mt-3 py-3 rounded-xl font-medium text-center block
                               border border-orange-200 text-orange-600 hover:bg-orange-50 transition-colors" do %>
                      üí≥ Í≤∞Ï†úÌïòÍ∏∞
                    <% end %>
                  <% end %>
                <% end %>
              <% end %>
            </div>

            <%# Trust Info Box - Integrated Profile %>
            <div class="p-4 bg-stone-50 rounded-2xl mb-5">
              <%= link_to profile_path(post.user), class: "flex items-center gap-3 mb-3 group" do %>
                <div class="relative">
                  <%= render_user_avatar(post.user, size: "lg") %>
                  <span class="absolute -bottom-0.5 -right-0.5 w-3 h-3 rounded-full
                               bg-emerald-500 ring-2 ring-stone-50"></span>
                </div>
                <div class="flex-1 min-w-0">
                  <p class="font-bold text-stone-900 group-hover:text-orange-600 transition-colors truncate">
                    <%= post.user.name %>
                  </p>
                  <p class="text-xs text-stone-500"><%= post.user.role_title.presence || "Maker" %></p>
                </div>
                <svg class="w-4 h-4 text-stone-400 group-hover:text-orange-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                </svg>
              <% end %>

              <%# Trust Indicators %>
              <div class="flex items-center gap-4 text-xs text-stone-600 pt-3 border-t border-stone-200/60">
                <span class="inline-flex items-center gap-1.5">
                  <svg class="w-3.5 h-3.5 text-emerald-500" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                  </svg>
                  <span>ÏùëÎãµ <strong class="text-stone-900">1ÏãúÍ∞Ñ Ïù¥ÎÇ¥</strong></span>
                </span>
                <span class="inline-flex items-center gap-1.5">
                  <svg class="w-3.5 h-3.5 text-yellow-500" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                  </svg>
                  <span>ÏùëÎãµÎ•† <strong class="text-stone-900">100%</strong></span>
                </span>
              </div>
            </div>

            <%# Secondary Actions - Save & Share %>
            <div class="flex items-center justify-center gap-3 pt-4 border-t border-stone-100">
              <%= render partial: "shared/like_button", locals: { post: post, liked: logged_in? ? post.liked_by?(current_user) : false } %>
              <%= render partial: "shared/bookmark_button", locals: { post: post, bookmarked: logged_in? ? post.bookmarked_by?(current_user) : false } %>
              <%= render partial: "shared/share_bottomsheet", locals: {
                url: post_url(post),
                title: post.title,
                description: post.content&.truncate(100)
              } %>
            </div>

          </div>
        </div>
      </aside>
    </div>
  </main>

  <%# ===== Mobile Fixed CTA ===== %>
  <div class="fixed bottom-0 left-0 right-0 lg:hidden bg-white border-t border-stone-200 p-4 z-40">
    <div class="flex items-center gap-3 max-w-lg mx-auto">
      <%# Price %>
      <div class="flex-shrink-0">
        <span class="text-lg font-bold text-stone-900"><%= post.price_display %></span>
      </div>

      <%# CTA Button %>
      <% if logged_in? && !post.owned_by?(current_user) %>
        <%= button_to start_chat_from_post_path(post),
                      method: :post,
                      class: "flex-1 py-3 rounded-xl font-bold text-center
                             bg-[#2C2825] text-white hover:bg-stone-800 transition-colors" do %>
          <%= post.hiring? ? "ÏßÄÏõêÌïòÍ∏∞" : "Ï†úÏïàÌïòÍ∏∞" %>
        <% end %>
      <% elsif !logged_in? %>
        <%= link_to login_path(return_to: post_path(post)),
            class: "flex-1 py-3 rounded-xl font-bold text-center block
                   bg-[#2C2825] text-white hover:bg-stone-800 transition-colors" do %>
          Î°úÍ∑∏Ïù∏ÌïòÍ∏∞
        <% end %>
      <% else %>
        <div class="flex-1 py-3 rounded-xl text-center text-stone-500 text-sm bg-stone-100">
          ÎÇ¥Í∞Ä ÏûëÏÑ±Ìïú Í∏ÄÏûÖÎãàÎã§
        </div>
      <% end %>

      <%# Bookmark %>
      <div class="flex-shrink-0">
        <%= render partial: "shared/bookmark_button", locals: { post: post, bookmarked: logged_in? ? post.bookmarked_by?(current_user) : false } %>
      </div>
    </div>
  </div>

  <%# Report Modal %>
  <% if logged_in? %>
    <%= render "reports/modal" %>
  <% end %>
</div>
