<div class="min-h-screen bg-background pb-20">
  <!-- Header -->
  <header class="sticky top-0 bg-background/95 backdrop-blur-sm border-b border-border z-40">
    <div class="max-w-screen-xl mx-auto px-4 py-3 flex items-center justify-between">
      <%= link_to post_path(@post), class: "text-muted-foreground hover:text-foreground p-1" do %>
        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      <% end %>

      <h1 class="text-lg font-semibold">글 수정</h1>

      <button
        type="submit"
        form="post-form"
        id="submit-button"
        class="px-4 py-1.5 rounded-full bg-primary text-primary-foreground text-sm font-medium hover:bg-primary/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
      >
        저장
      </button>
    </div>
  </header>

  <!-- Main Content -->
  <main class="max-w-screen-xl mx-auto px-4 py-6" data-controller="post-form">
    <%= form_with model: @post, id: "post-form", local: true, data: { action: "input->post-form#validateForm" } do |f| %>
      <% if @post.errors.any? %>
        <div class="mb-6 p-4 rounded-lg bg-destructive/10 border border-destructive/20">
          <div class="flex items-start gap-3">
            <svg class="h-5 w-5 text-destructive flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <div>
              <p class="text-sm font-medium text-destructive">입력 오류가 있습니다</p>
              <ul class="mt-1 text-sm text-destructive/80 list-disc list-inside">
                <% @post.errors.full_messages.each do |message| %>
                  <li><%= message %></li>
                <% end %>
              </ul>
            </div>
          </div>
        </div>
      <% end %>

      <div class="space-y-6">
        <!-- Category Selection -->
        <div class="bg-card rounded-xl p-4 border border-border">
          <label class="block text-sm font-medium text-foreground mb-3">카테고리</label>
          <div class="flex flex-wrap gap-2" data-post-form-target="categoryContainer">
            <% if @initial_type == 'community' %>
              <% [['free', '자유'], ['question', '질문'], ['promotion', '홍보']].each do |value, label| %>
                <label class="relative cursor-pointer">
                  <%= f.radio_button :category, value,
                      checked: @post.category == value,
                      class: "peer sr-only",
                      data: { post_form_target: "category", action: "change->post-form#toggleOutsourcingFields" } %>
                  <span class="inline-flex items-center px-4 py-2 rounded-full border border-border text-sm font-medium transition-colors peer-checked:bg-primary peer-checked:text-primary-foreground peer-checked:border-primary hover:bg-secondary/50">
                    <%= label %>
                  </span>
                </label>
              <% end %>
            <% else %>
              <% [['hiring', '구인 (사람 찾아요)'], ['seeking', '구직 (일 해드려요)']].each do |value, label| %>
                <label class="relative cursor-pointer">
                  <%= f.radio_button :category, value,
                      checked: @post.category == value,
                      class: "peer sr-only",
                      data: { post_form_target: "category", action: "change->post-form#toggleOutsourcingFields" } %>
                  <span class="inline-flex items-center px-4 py-2 rounded-full border border-border text-sm font-medium transition-colors peer-checked:bg-primary peer-checked:text-primary-foreground peer-checked:border-primary hover:bg-secondary/50">
                    <%= label %>
                  </span>
                </label>
              <% end %>
            <% end %>
          </div>
        </div>

        <!-- Title -->
        <div class="bg-card rounded-xl p-4 border border-border">
          <%= f.label :title, "제목", class: "block text-sm font-medium text-foreground mb-2" %>
          <%= f.text_field :title,
              placeholder: "매력적인 제목을 지어주세요",
              data: { post_form_target: "title" },
              class: "w-full px-4 py-3 rounded-lg border border-border bg-background text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring text-base" %>
        </div>

        <!-- Outsourcing Fields (Dynamic) -->
        <div
          data-post-form-target="outsourcingFields"
          class="<%= @initial_type == 'outsourcing' ? '' : 'hidden' %> space-y-4"
        >
          <div class="bg-card rounded-xl p-4 border border-border space-y-4">
            <h3 class="text-sm font-medium text-foreground">외주 정보</h3>

            <!-- Service Type -->
            <div>
              <%= f.label :service_type, "서비스 분야", class: "block text-sm font-medium text-muted-foreground mb-2" %>
              <%= f.select :service_type,
                  options_for_select(Post::SERVICE_TYPES.map { |k, v| [v, k] }, @post.service_type),
                  { include_blank: "분야 선택" },
                  { class: "w-full px-4 py-3 rounded-lg border border-border bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-ring", data: { post_form_target: "serviceType", action: "change->post-form#validateForm" } } %>
            </div>

            <!-- Price -->
            <div>
              <%= f.label :price, "예산/금액", class: "block text-sm font-medium text-muted-foreground mb-2" %>
              <div class="flex items-center gap-3">
                <div class="relative flex-1">
                  <span class="absolute left-4 top-1/2 -translate-y-1/2 text-muted-foreground">₩</span>
                  <%= f.number_field :price,
                      placeholder: "0",
                      min: 0,
                      class: "w-full pl-10 pr-4 py-3 rounded-lg border border-border bg-background text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring" %>
                </div>
                <label class="flex items-center gap-2 whitespace-nowrap cursor-pointer">
                  <%= f.check_box :price_negotiable, class: "h-5 w-5 rounded border-border text-primary focus:ring-primary" %>
                  <span class="text-sm text-muted-foreground">협의 가능</span>
                </label>
              </div>
            </div>

            <!-- Work Period -->
            <div>
              <%= f.label :work_period, "예상 기간/마감일", class: "block text-sm font-medium text-muted-foreground mb-2" %>
              <%= f.text_field :work_period,
                  placeholder: "예: 1주일, 2025년 1월까지",
                  class: "w-full px-4 py-3 rounded-lg border border-border bg-background text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring" %>
            </div>
          </div>
        </div>

        <!-- Content -->
        <div class="bg-card rounded-xl p-4 border border-border">
          <%= f.label :content, "내용", class: "block text-sm font-medium text-foreground mb-2" %>
          <%= f.text_area :content,
              placeholder: @initial_type == 'outsourcing' ? "어떤 작업이 필요한지 구체적으로 적어주세요." : "창업 아이디어, 개발 고민, 팀 빌딩 등 자유롭게 이야기해보세요.",
              rows: 10,
              data: { post_form_target: "content" },
              class: "w-full px-4 py-3 rounded-lg border border-border bg-background text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring resize-none" %>
        </div>

        <!-- Delete Button -->
        <div class="pt-4 border-t border-border">
          <%= button_to "게시글 삭제", post_path(@post),
              method: :delete,
              form: { data: { turbo_confirm: "정말 삭제하시겠습니까?" } },
              class: "w-full py-3 rounded-lg border border-destructive text-destructive hover:bg-destructive hover:text-destructive-foreground transition-colors" %>
        </div>
      </div>
    <% end %>
  </main>
</div>
