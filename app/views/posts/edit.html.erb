<div class="min-h-screen bg-background pb-20">
  <!-- Header -->
  <header class="sticky top-0 bg-background/95 backdrop-blur-sm border-b border-border z-40">
    <div class="max-w-screen-xl mx-auto px-4 py-3 flex items-center justify-between">
      <%= link_to post_path(@post), class: "text-muted-foreground hover:text-foreground p-1" do %>
        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      <% end %>

      <h1 class="text-lg font-semibold">글 수정</h1>

      <button
        type="submit"
        form="post-form"
        id="submit-button"
        class="px-4 py-1.5 rounded-full bg-primary text-primary-foreground text-sm font-medium hover:bg-primary/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
      >
        저장
      </button>
    </div>
  </header>

  <!-- Main Content -->
  <main class="max-w-screen-xl mx-auto px-4 py-6" data-controller="post-form">
    <%= form_with model: @post, id: "post-form", local: true, html: { multipart: true }, data: { action: "input->post-form#validateForm" } do |f| %>
      <% if @post.errors.any? %>
        <div class="mb-6 p-4 rounded-lg bg-destructive/10 border border-destructive/20">
          <div class="flex items-start gap-3">
            <svg class="h-5 w-5 text-destructive flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <div>
              <p class="text-sm font-medium text-destructive">입력 오류가 있습니다</p>
              <ul class="mt-1 text-sm text-destructive/80 list-disc list-inside">
                <% @post.errors.full_messages.each do |message| %>
                  <li><%= message %></li>
                <% end %>
              </ul>
            </div>
          </div>
        </div>
      <% end %>

      <!-- Hidden category field -->
      <%= f.hidden_field :category %>

      <div class="space-y-4">
        <!-- Title -->
        <div class="bg-card rounded-xl p-4 border border-border">
          <%= f.text_field :title,
              placeholder: "제목을 입력하세요",
              data: { post_form_target: "title" },
              class: "w-full bg-transparent text-foreground text-lg font-medium placeholder:text-muted-foreground focus:outline-none border-none" %>
        </div>

        <!-- Content -->
        <div class="bg-card rounded-xl p-4 border border-border">
          <%= f.text_area :content,
              placeholder: "창업 아이디어, 개발 고민, 팀 빌딩 등 자유롭게 이야기해보세요.",
              rows: 12,
              data: { post_form_target: "content" },
              class: "w-full bg-transparent text-foreground placeholder:text-muted-foreground focus:outline-none resize-none border-none" %>
        </div>

        <!-- Existing Images -->
        <% if @post.images.attached? %>
          <div class="bg-card rounded-xl p-4 border border-border">
            <label class="flex items-center text-sm font-medium text-foreground mb-3">
              <svg class="h-5 w-5 mr-2 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
              </svg>
              기존 첨부 사진
            </label>
            <div class="grid grid-cols-3 gap-2">
              <% @post.images.each do |image| %>
                <div class="relative aspect-square rounded-lg overflow-hidden bg-secondary">
                  <%= image_tag image, class: "w-full h-full object-cover", alt: "첨부 이미지" %>
                </div>
              <% end %>
            </div>
            <p class="mt-2 text-xs text-muted-foreground">새 사진을 업로드하면 기존 사진이 교체됩니다</p>
          </div>
        <% end %>

        <!-- Image Upload -->
        <div class="bg-card rounded-xl p-4 border border-border" data-controller="image-upload">
          <div class="flex items-center justify-between mb-3">
            <label class="flex items-center text-sm font-medium text-foreground">
              <svg class="h-5 w-5 mr-2 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
              </svg>
              새 사진 추가
            </label>
            <span class="text-xs text-muted-foreground" data-image-upload-target="counter">0/5</span>
          </div>

          <!-- Image Preview Area -->
          <div
            data-image-upload-target="preview"
            class="grid grid-cols-3 gap-2 mb-3 empty:hidden"
          >
          </div>

          <!-- Upload Button -->
          <label class="flex items-center justify-center gap-2 p-4 border-2 border-dashed border-border rounded-lg cursor-pointer hover:border-primary/50 hover:bg-secondary/30 transition-colors" data-image-upload-target="dropzone">
            <svg class="h-6 w-6 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
            </svg>
            <span class="text-sm text-muted-foreground">사진 추가</span>
            <%= f.file_field :images,
                multiple: true,
                accept: "image/*",
                class: "hidden",
                data: { image_upload_target: "input", action: "change->image-upload#handleFiles" } %>
          </label>

          <p class="mt-2 text-xs text-muted-foreground text-center">JPG, PNG, GIF (각 10MB 이하)</p>
        </div>

        <!-- Outsourcing Fields (외주용) -->
        <% if @initial_type == 'outsourcing' %>
          <div class="bg-card rounded-xl p-4 border border-border space-y-4">
            <h3 class="text-sm font-medium text-foreground">외주 정보</h3>

            <!-- Service Type -->
            <div>
              <%= f.label :service_type, "서비스 분야", class: "block text-sm text-muted-foreground mb-2" %>
              <%= f.select :service_type,
                  options_for_select(Post::SERVICE_TYPES.map { |k, v| [v, k] }, @post.service_type),
                  { include_blank: "분야 선택" },
                  { class: "w-full px-4 py-3 rounded-lg border border-border bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-ring" } %>
            </div>

            <!-- Price -->
            <div>
              <%= f.label :price, "예산/금액", class: "block text-sm text-muted-foreground mb-2" %>
              <div class="flex items-center gap-3">
                <div class="relative flex-1">
                  <span class="absolute left-4 top-1/2 -translate-y-1/2 text-muted-foreground">₩</span>
                  <%= f.number_field :price,
                      placeholder: "0",
                      min: 0,
                      class: "w-full pl-10 pr-4 py-3 rounded-lg border border-border bg-background text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring" %>
                </div>
                <label class="flex items-center gap-2 whitespace-nowrap cursor-pointer">
                  <%= f.check_box :price_negotiable, class: "h-5 w-5 rounded border-border text-primary focus:ring-primary" %>
                  <span class="text-sm text-muted-foreground">협의 가능</span>
                </label>
              </div>
            </div>

            <!-- Work Period -->
            <div>
              <%= f.label :work_period, "예상 기간", class: "block text-sm text-muted-foreground mb-2" %>
              <%= f.text_field :work_period,
                  placeholder: "예: 1주일, 2025년 1월까지",
                  class: "w-full px-4 py-3 rounded-lg border border-border bg-background text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring" %>
            </div>
          </div>
        <% end %>

        <!-- Delete Button -->
        <div class="pt-4 border-t border-border">
          <%= button_to "게시글 삭제", post_path(@post),
              method: :delete,
              form: { data: { turbo_confirm: "정말 삭제하시겠습니까?" } },
              class: "w-full py-3 rounded-lg border border-destructive text-destructive hover:bg-destructive hover:text-destructive-foreground transition-colors" %>
        </div>
      </div>
    <% end %>
  </main>
</div>
