<%# 커뮤니티 글 카드 - 재사용 가능한 컴포넌트 %>
<%# 사용법: render partial: "posts/community_post_card", locals: { post: @post } %>
<%# 옵션: show_author: true/false (기본값: true) - 작성자 정보 표시 여부 %>
<%# 옵션: show_actions: true/false (기본값: true) - 하단 액션 버튼 표시 여부 %>

<% show_author = local_assigns.fetch(:show_author, true) %>
<% show_actions = local_assigns.fetch(:show_actions, true) %>

<article class="rounded-xl border bg-card text-card-foreground p-4 sm:p-6 card-hover">
  <% if show_author %>
    <!-- Author Info -->
    <%= link_to profile_path(post.user_id), class: "flex items-start gap-3 group mb-4" do %>
      <%= render_user_avatar(post.user, size: "md", ring: "ring-2 ring-background group-hover:ring-primary/20 transition-all") %>
      <div class="flex-1">
        <div class="flex items-center gap-2">
          <h3 class="font-semibold group-hover:text-primary transition-colors"><%= post.user.name %></h3>
          <% if post.user.role_title.present? %>
            <%= render_badge post.user.role_title, variant: :secondary, class: "text-xs" %>
          <% end %>
        </div>
        <p class="text-xs text-muted-foreground"><%= time_ago_in_words(post.created_at) %> 전</p>
      </div>
    <% end %>
  <% end %>

  <!-- Post Content -->
  <%= link_to post_path(post.id), class: "block" do %>
    <div class="flex gap-2 sm:gap-4">
      <div class="flex-1 min-w-0">
        <h2 class="text-base sm:text-lg font-semibold mb-2 link-hover relative cursor-pointer">
          <%= post.title %>
        </h2>
        <p class="text-foreground mb-3 leading-relaxed link-hover relative cursor-pointer line-clamp-3">
          <%= post.content %>
        </p>
      </div>
      <% if post.images.attached? %>
        <div class="flex-shrink-0">
          <div class="relative w-[clamp(3rem,8vw,4rem)] h-[clamp(3rem,8vw,4rem)] rounded-lg overflow-hidden bg-secondary">
            <%= image_tag post.images.first, class: "w-full h-full object-cover", alt: "첨부 이미지" %>
            <% if post.images.count > 1 %>
              <div class="absolute inset-0 bg-black/50 flex items-center justify-center">
                <span class="text-white text-xs sm:text-sm font-bold">+<%= post.images.count - 1 %></span>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>

  <% if show_actions %>
    <!-- Actions -->
    <div class="flex items-center gap-2 sm:gap-4 pt-3 border-t border-border">
      <%= render partial: "shared/like_button", locals: { post: post, liked: defined?(current_user) && current_user ? post.liked_by?(current_user) : false, size: "sm" } %>
      <%= link_to post_path(post), class: "inline-flex items-center justify-center gap-2 whitespace-nowrap text-sm font-medium btn-hover focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 h-9 rounded-md px-3" do %>
        <%= render partial: "shared/icons/message_square", locals: { css_css_class: "h-4 w-4" } %>
        <span><%= post.comments_count %></span>
      <% end %>
      <%= render partial: "shared/share_button", locals: {
        url: post_url(post),
        title: post.title,
        description: post.content.truncate(80),
        size: "sm"
      } %>
      <div class="ml-auto">
        <%= render partial: "shared/bookmark_button", locals: { post: post, bookmarked: defined?(current_user) && current_user ? post.bookmarked_by?(current_user) : false, size: "sm" } %>
      </div>
    </div>
  <% else %>
    <!-- Simple Stats (for profile page) -->
    <div class="flex items-center gap-4 text-sm text-muted-foreground">
      <span><%= post.likes_count %> 좋아요</span>
      <span><%= post.comments_count %> 댓글</span>
      <span class="ml-auto"><%= time_ago_in_words(post.created_at) %> 전</span>
    </div>
  <% end %>
</article>
