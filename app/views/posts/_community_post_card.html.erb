<%# 커뮤니티 글 카드 - 재사용 가능한 컴포넌트 %>
<%# 사용법: render partial: "posts/community_post_card", locals: { post: @post } %>
<%# 옵션: show_author: true/false (기본값: true) - 작성자 정보 표시 여부 %>
<%# 옵션: show_actions: true/false (기본값: true) - 하단 액션 버튼 표시 여부 %>

<% show_author = local_assigns.fetch(:show_author, true) %>
<% show_actions = local_assigns.fetch(:show_actions, true) %>

<article class="bg-card rounded-xl p-6 border border-border hover:border-muted-foreground/20 transition-colors">
  <% if show_author %>
    <!-- Author Info -->
    <%= link_to profile_path(post.user_id), class: "flex items-start gap-3 group mb-4" do %>
      <div class="h-10 w-10 rounded-full ring-2 ring-background group-hover:ring-primary/20 transition-all overflow-hidden bg-secondary flex items-center justify-center">
        <% if post.user.avatar.attached? %>
          <%= image_tag post.user.avatar, alt: post.user.name, class: "h-full w-full object-cover" %>
        <% elsif post.user.avatar_url.present? %>
          <%= image_tag post.user.avatar_url, alt: post.user.name, class: "h-full w-full object-cover" %>
        <% else %>
          <span class="text-lg font-semibold"><%= post.user.name[0] %></span>
        <% end %>
      </div>
      <div class="flex-1">
        <div class="flex items-center gap-2">
          <h3 class="font-semibold group-hover:text-primary transition-colors"><%= post.user.name %></h3>
          <% if post.user.role_title.present? %>
            <span class="inline-flex items-center rounded-md bg-secondary px-2 py-1 text-xs font-medium text-secondary-foreground">
              <%= post.user.role_title %>
            </span>
          <% end %>
        </div>
        <p class="text-xs text-muted-foreground"><%= time_ago_in_words(post.created_at) %> 전</p>
      </div>
    <% end %>
  <% end %>

  <!-- Post Content -->
  <%= link_to post_path(post.id) do %>
    <h2 class="text-lg font-semibold mb-2 hover:text-primary transition-colors cursor-pointer">
      <%= post.title %>
    </h2>
    <p class="text-foreground mb-3 leading-relaxed hover:text-primary transition-colors cursor-pointer line-clamp-3">
      <%= post.content %>
    </p>
  <% end %>

  <% if show_actions %>
    <!-- Actions -->
    <div class="flex items-center gap-4 pt-3 border-t border-border">
      <button class="inline-flex items-center justify-center gap-2 whitespace-nowrap text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-9 rounded-md px-3">
        <%= render partial: "shared/icons/heart", locals: { css_class: "h-4 w-4" } %>
        <span><%= post.likes_count %></span>
      </button>
      <button class="inline-flex items-center justify-center gap-2 whitespace-nowrap text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-9 rounded-md px-3">
        <%= render partial: "shared/icons/message_square", locals: { css_class: "h-4 w-4" } %>
        <span><%= post.comments_count %></span>
      </button>
      <button class="inline-flex items-center justify-center gap-2 whitespace-nowrap text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-9 rounded-md px-3">
        <%= render partial: "shared/icons/share", locals: { css_class: "h-4 w-4" } %>
      </button>
      <button class="inline-flex items-center justify-center gap-2 whitespace-nowrap text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-9 rounded-md px-3 ml-auto">
        <%= render partial: "shared/icons/bookmark", locals: { css_class: "h-4 w-4" } %>
      </button>
    </div>
  <% else %>
    <!-- Simple Stats (for profile page) -->
    <div class="flex items-center gap-4 text-sm text-muted-foreground">
      <span><%= post.likes_count %> 좋아요</span>
      <span><%= post.comments_count %> 댓글</span>
      <span class="ml-auto"><%= time_ago_in_words(post.created_at) %> 전</span>
    </div>
  <% end %>
</article>
