<%# 외주 글 카드 (구인/구직) - 재사용 가능한 컴포넌트 %>
<%# 사용법: render partial: "posts/outsourcing_post_card", locals: { post: @post } %>
<%# 옵션: show_author: true/false (기본값: true) - 작성자 정보 표시 여부 %>

<% show_author = local_assigns.fetch(:show_author, true) %>

<article class="rounded-xl border bg-card text-card-foreground p-6 hover:border-primary/50 transition-all mb-4">
  <% if show_author %>
    <!-- Author Info (프로필 링크) -->
    <%= link_to profile_path(post.user_id), class: "flex items-center gap-3 mb-4 group" do %>
      <div class="h-10 w-10 rounded-full bg-secondary flex items-center justify-center overflow-hidden flex-shrink-0">
        <% if post.user.avatar.attached? %>
          <%= image_tag post.user.avatar, alt: post.user.name, class: "h-full w-full object-cover" %>
        <% elsif post.user.avatar_url.present? %>
          <%= image_tag post.user.avatar_url, alt: post.user.name, class: "h-full w-full object-cover" %>
        <% else %>
          <span class="text-lg font-semibold"><%= post.user.name[0] %></span>
        <% end %>
      </div>
      <div class="flex-1">
        <p class="font-semibold text-sm text-foreground group-hover:text-primary transition-colors"><%= post.user.name %></p>
        <% if post.user.role_title.present? %>
          <p class="text-xs text-muted-foreground"><%= post.user.role_title %></p>
        <% end %>
      </div>
    <% end %>
  <% end %>

  <!-- 글 상세 링크 (카드 본문 클릭 시) -->
  <%= link_to post_path(post), class: "block" do %>
    <!-- Category & Service Type Badges -->
    <div class="flex flex-wrap items-center gap-2 mb-3">
      <% if post.hiring? %>
        <%= render partial: "shared/icons/briefcase", locals: { css_class: "h-4 w-4 text-blue-500" } %>
        <span class="inline-flex items-center rounded-md bg-blue-500/10 text-blue-600 px-2.5 py-0.5 text-xs font-semibold">
          구인
        </span>
      <% else %>
        <%= render partial: "shared/icons/user", locals: { css_class: "h-4 w-4 text-green-500" } %>
        <span class="inline-flex items-center rounded-md bg-green-500/10 text-green-600 px-2.5 py-0.5 text-xs font-semibold">
          구직
        </span>
      <% end %>
      <% if post.service_type.present? %>
        <%= render_badge Post::SERVICE_TYPES[post.service_type], variant: :secondary, class: "text-xs" %>
      <% end %>
    </div>

    <!-- Title & Content -->
    <div class="flex gap-4">
      <div class="flex-1 min-w-0">
        <h3 class="text-lg font-bold mb-2 text-foreground"><%= post.title %></h3>
        <p class="text-sm text-muted-foreground mb-4 line-clamp-2"><%= post.content %></p>
      </div>
      <% if post.images.attached? %>
        <div class="flex-shrink-0">
          <div class="relative w-16 h-16 rounded-lg overflow-hidden bg-secondary">
            <%= image_tag post.images.first, class: "w-full h-full object-cover", alt: "첨부 이미지" %>
            <% if post.images.count > 1 %>
              <div class="absolute inset-0 bg-black/50 flex items-center justify-center">
                <span class="text-white text-sm font-bold">+<%= post.images.count - 1 %></span>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>

    <!-- Meta Info -->
    <div class="flex flex-wrap items-center gap-4 text-sm text-muted-foreground mb-3">
      <span class="font-medium text-primary"><%= post.price_display %></span>
      <% if post.work_period.present? %>
        <span>기간: <%= post.work_period %></span>
      <% end %>
      <span>조회 <%= post.views_count %></span>
      <span class="ml-auto"><%= time_ago_in_words(post.created_at) %> 전</span>
    </div>
  <% end %>

  <!-- Actions -->
  <div class="flex items-center gap-4 pt-3 border-t border-border">
    <%= render partial: "shared/like_button", locals: { post: post, liked: defined?(current_user) && current_user ? post.liked_by?(current_user) : false, size: "sm" } %>
    <%= link_to post_path(post), class: "inline-flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground transition-colors" do %>
      <%= render partial: "shared/icons/message_square", locals: { css_class: "h-4 w-4" } %>
      <span><%= post.comments_count %></span>
    <% end %>
    <%= render partial: "shared/share_button", locals: {
      url: post_url(post),
      title: post.title,
      description: post.content.truncate(80),
      size: "sm"
    } %>
    <div class="ml-auto">
      <%= render partial: "shared/bookmark_button", locals: { post: post, bookmarked: defined?(current_user) && current_user ? post.bookmarked_by?(current_user) : false, size: "sm" } %>
    </div>
  </div>
</article>
