<% content_for :head do %>
  <meta name="turbo-cache-control" content="no-cache">
<% end %>

<div class="min-h-screen bg-background pb-20" data-controller="navigation" data-navigation-reset-on-connect-value="true">
  <!-- Header -->
  <%= render partial: "shared/main_header" %>

  <!-- Main Content -->
  <main class="max-w-screen-xl mx-auto px-4 py-6">
    <div class="w-full">
      <!-- Tab Headers -->
      <div class="inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground w-full grid grid-cols-2 mb-6">
        <button data-tab="hiring" class="tab-trigger-freelance active inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background btn-hover focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow">
          <%= render partial: "shared/icons/briefcase", locals: { css_class: "h-4 w-4 mr-2" } %>
          구인 (<%= @hiring_posts.count %>)
        </button>
        <button data-tab="seeking" class="tab-trigger-freelance inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background btn-hover focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow">
          <%= render partial: "shared/icons/user", locals: { css_class: "h-4 w-4 mr-2" } %>
          구직 (<%= @seeking_posts.count %>)
        </button>
      </div>

      <!-- Hiring Tab (구인 공고) -->
      <div id="tab-hiring" class="tab-content-freelance">
        <% if @hiring_posts.any? %>
          <%# 반응형 그리드: 1열(모바일) → 2열(태블릿) → 3열(데스크톱) %>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <% @hiring_posts.each do |post| %>
              <%= render_post_card(post, variant: :outsourcing) %>
            <% end %>
          </div>
        <% else %>
          <div class="text-center py-20 text-muted-foreground">
            <%= render partial: "shared/icons/briefcase", locals: { css_class: "h-16 w-16 mx-auto mb-4 opacity-50" } %>
            <p class="text-lg font-medium mb-2">아직 등록된 구인 공고가 없습니다</p>
            <p class="text-sm">첫 번째 구인 공고를 등록해보세요!</p>
          </div>
        <% end %>
      </div>

      <!-- Seeking Tab (구직 정보) -->
      <div id="tab-seeking" class="tab-content-freelance hidden">
        <% if @seeking_posts.any? %>
          <%# 반응형 그리드: 1열(모바일) → 2열(태블릿) → 3열(데스크톱) %>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <% @seeking_posts.each do |post| %>
              <%= render_post_card(post, variant: :outsourcing) %>
            <% end %>
          </div>
        <% else %>
          <div class="text-center py-20 text-muted-foreground">
            <%= render partial: "shared/icons/user", locals: { css_class: "h-16 w-16 mx-auto mb-4 opacity-50" } %>
            <p class="text-lg font-medium mb-2">아직 등록된 구직 정보가 없습니다</p>
            <p class="text-sm">첫 번째 구직 정보를 등록해보세요!</p>
          </div>
        <% end %>
      </div>
    </div>
  </main>

  <%= render "shared/bottom_nav" %>
</div>

<script>
  // Tab switching for freelance page
  function setupFreelanceTabs() {
    const tabTriggers = document.querySelectorAll('.tab-trigger-freelance');
    const tabContents = document.querySelectorAll('.tab-content-freelance');

    // Initialize: ensure hiring tab is visible and button is selected by default
    const hiringTab = document.getElementById('tab-hiring');
    const seekingTab = document.getElementById('tab-seeking');
    const hiringButton = document.querySelector('[data-tab="hiring"]');
    const seekingButton = document.querySelector('[data-tab="seeking"]');

    if (hiringTab && seekingTab) {
      // Show hiring content, hide seeking content
      hiringTab.classList.remove('hidden');
      seekingTab.classList.add('hidden');
    }

    if (hiringButton && seekingButton) {
      // Set hiring button as active
      hiringButton.classList.add('active', 'bg-background', 'text-foreground', 'shadow');
      // Ensure seeking button is not active
      seekingButton.classList.remove('active', 'bg-background', 'text-foreground', 'shadow');
    }

    tabTriggers.forEach(trigger => {
      trigger.addEventListener('click', function() {
        const tabId = this.getAttribute('data-tab');

        // Remove active class from all triggers
        tabTriggers.forEach(t => t.classList.remove('active', 'bg-background', 'text-foreground', 'shadow'));

        // Add active class to clicked trigger
        this.classList.add('active', 'bg-background', 'text-foreground', 'shadow');

        // Hide all tab contents
        tabContents.forEach(content => content.classList.add('hidden'));

        // Show selected tab content
        document.getElementById('tab-' + tabId).classList.remove('hidden');
      });
    });
  }

  // Support both initial load and Turbo navigation
  document.addEventListener('DOMContentLoaded', setupFreelanceTabs);
  document.addEventListener('turbo:load', setupFreelanceTabs);
  document.addEventListener('turbo:render', setupFreelanceTabs);
</script>
