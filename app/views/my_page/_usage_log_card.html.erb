<%# 사용 기록 카드 partial %>
<%# locals: log (AiUsageLog), analysis (IdeaAnalysis or nil), expired (boolean) %>

<div class="bg-card rounded-xl border border-border p-4 <%= expired ? 'opacity-70' : 'card-hover' %> mb-3">
  <!-- 점수 뱃지 & 날짜 & 만료 표시 -->
  <div class="flex items-center justify-between mb-2">
    <div class="flex items-center gap-2">
      <%# 점수 뱃지 - log에서 가져옴 (분석 삭제 후에도 유지) %>
      <% score = log.score.to_i %>
      <span class="inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium <%= score >= 70 ? 'bg-green-500/10 text-green-600' : score >= 50 ? 'bg-yellow-500/10 text-yellow-600' : 'bg-red-500/10 text-red-600' %>">
        <span class="font-bold"><%= score %>점</span>
      </span>

      <% if expired %>
        <%# 만료 표시 %>
        <span class="inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-muted text-muted-foreground">
          <svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
          </svg>
          만료됨
        </span>
      <% elsif log.was_saved %>
        <%# 저장됨 표시 %>
        <span class="inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-blue-500/10 text-blue-600">
          <svg class="h-3 w-3" fill="currentColor" viewBox="0 0 20 20">
            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"/>
          </svg>
          저장됨
        </span>
      <% end %>
    </div>

    <span class="text-xs text-muted-foreground">
      <%= log.created_at.strftime("%Y.%m.%d %H:%M") %>
    </span>
  </div>

  <!-- 아이디어 내용 -->
  <p class="text-sm font-medium line-clamp-2 mb-2 <%= expired ? 'text-muted-foreground' : '' %>">
    <%= log.idea_summary %>
  </p>

  <% if expired %>
    <!-- 만료된 분석 안내 메시지 -->
    <div class="flex items-center gap-2 mt-3 pt-3 border-t border-border">
      <svg class="h-4 w-4 text-muted-foreground flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
      </svg>
      <p class="text-xs text-muted-foreground">
        7일 경과로 상세 결과가 삭제되었습니다
      </p>
    </div>
  <% elsif analysis.present? && analysis.summary.present? %>
    <!-- 요약 (있으면) -->
    <p class="text-xs text-muted-foreground line-clamp-1"><%= analysis.summary %></p>
  <% end %>
</div>
